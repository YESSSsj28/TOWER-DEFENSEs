<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Chat</title>
  <style>
    :root {
      --primary: #6c5ce7;
      --primary-dark: #5649c0;
      --background: #1a1a2e;
      --surface: #16213e;
      --surface-light: #2a3a5e;
      --text: #e2e2e2;
      --text-secondary: #b8b8b8;
      --success: #00b894;
      --error: #d63031;
      --online: #00b894;
      --offline: #636e72;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    body {
      background-color: var(--background);
      color: var(--text);
      height: 100vh;
      display: flex;
    }

    /* Auth Container */
    .auth-container {
      width: 100%;
      max-width: 400px;
      margin: auto;
      padding: 2rem;
      background: var(--surface);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .auth-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, var(--primary), #a29bfe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .input-group label {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .input-group input {
      padding: 0.8rem 1rem;
      background: var(--surface-light);
      border: 2px solid transparent;
      border-radius: 8px;
      color: var(--text);
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .input-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.2);
    }

    .auth-button {
      padding: 0.8rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .auth-button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .auth-toggle {
      text-align: center;
      margin-top: 1rem;
      color: var(--text-secondary);
    }

    .auth-toggle a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
    }

    .error-message {
      color: var(--error);
      font-size: 0.9rem;
      text-align: center;
      margin-top: 1rem;
    }

    /* Chat Container */
    .chat-container {
      display: none;
      width: 100%;
      height: 100vh;
      max-width: 1200px;
      margin: 0 auto;
      background: var(--surface);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    /* Sidebar */
    .sidebar {
      width: 300px;
      background: var(--surface);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-title {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--primary), #a29bfe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .channels {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .channel {
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
    }

    .channel:hover {
      background: var(--surface-light);
    }

    .channel.active {
      background: var(--surface-light);
      border-left: 4px solid var(--primary);
    }

    .channel-name {
      flex: 1;
      font-weight: 500;
    }

    .channel-unread {
      background: var(--primary);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .user-profile {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-weight: 600;
    }

    .user-status {
      font-size: 0.8rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--online);
    }

    /* Main Chat */
    .main-chat {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .chat-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
    }

    .chat-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .chat-members {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-left: 0.5rem;
    }

    .messages {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      max-width: 70%;
      display: flex;
      flex-direction: column;
    }

    .message.received {
      align-self: flex-start;
    }

    .message.sent {
      align-self: flex-end;
    }

    .message-info {
      display: flex;
      align-items: center;
      margin-bottom: 0.3rem;
    }

    .message-sender {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .message-time {
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-left: 0.5rem;
    }

    .message-content {
      padding: 0.8rem 1rem;
      border-radius: 12px;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .message.received .message-content {
      background: var(--surface-light);
      border-top-left-radius: 4px;
    }

    .message.sent .message-content {
      background: var(--primary);
      color: white;
      border-top-right-radius: 4px;
    }

    .input-area {
      padding: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .message-input {
      width: 100%;
      padding: 0.8rem 1rem;
      background: var(--surface-light);
      border: none;
      border-radius: 8px;
      color: var(--text);
      font-size: 1rem;
      resize: none;
    }

    .message-input:focus {
      outline: none;
      box-shadow: 0 0 0 2px var(--primary);
    }

    /* System message */
    .system-message {
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin: 1rem 0;
    }

    /* Loading spinner */
    .spinner {
      width: 40px;
      height: 40px;
      margin: 2rem auto;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-left-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Auth Container -->
  <div class="auth-container" id="authContainer">
    <div class="auth-title">Neon Chat</div>
    <div class="error-message" id="errorMessage"></div>
    
    <!-- Login Form -->
    <form class="auth-form" id="loginForm">
      <div class="input-group">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" required>
      </div>
      <div class="input-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" required>
      </div>
      <button type="submit" class="auth-button">Sign In</button>
      <div class="auth-toggle">
        Don't have an account? <a id="showRegister">Register</a>
      </div>
    </form>
    
    <!-- Register Form -->
    <form class="auth-form" id="registerForm" style="display: none;">
      <div class="input-group">
        <label for="registerName">Username</label>
        <input type="text" id="registerName" required>
      </div>
      <div class="input-group">
        <label for="registerEmail">Email</label>
        <input type="email" id="registerEmail" required>
      </div>
      <div class="input-group">
        <label for="registerPassword">Password</label>
        <input type="password" id="registerPassword" required minlength="6">
      </div>
      <button type="submit" class="auth-button">Create Account</button>
      <div class="auth-toggle">
        Already have an account? <a id="showLogin">Sign In</a>
      </div>
    </form>
  </div>

  <!-- Chat Container -->
  <div class="chat-container" id="chatContainer">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">Channels</div>
      </div>
      
      <div class="channels" id="channelsList">
        <div class="channel active" data-channel="general">
          <div class="channel-name">General</div>
          <div class="channel-unread">3</div>
        </div>
        <div class="channel" data-channel="random">
          <div class="channel-name">Random</div>
          <div class="channel-unread">0</div>
        </div>
        <div class="channel" data-channel="support">
          <div class="channel-name">Support</div>
          <div class="channel-unread">1</div>
        </div>
      </div>
      
      <div class="user-profile" id="userProfile">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-info">
          <div class="user-name" id="userName">User</div>
          <div class="user-status">
            <div class="status-indicator"></div>
            <span>Online</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Chat -->
    <div class="main-chat">
      <div class="chat-header">
        <div class="chat-title" id="currentChannelName">General</div>
        <div class="chat-members" id="channelMembersCount">5 members</div>
      </div>
      
      <div class="messages" id="messagesContainer">
        <div class="system-message">Welcome to the General channel!</div>
      </div>
      
      <div class="input-area">
        <input type="text" class="message-input" id="messageInput" placeholder="Type your message..." disabled>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script>
    // Firebase config (replace with your actual config)
    const firebaseConfig = {
      apiKey: "AIzaSyD9uzP781-TlDSC9fILQX8M-Xa7Ely_rZc",
      authDomain: "chayt-41951.firebaseapp.com",
      projectId: "chayt-41951",
      storageBucket: "chayt-41951.appspot.com",
      messagingSenderId: "841659925542",
      appId: "1:841659925542:web:ba7751ee2a97b5fcf452e7",
      measurementId: "G-NMWMFY7BG5"
    };

    // Initialize Firebase
    try {
      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const auth = firebase.auth();
      console.log("Firebase initialized successfully");
    } catch (error) {
      console.error("Firebase initialization error:", error);
      document.getElementById("errorMessage").textContent = "Failed to initialize the app. Please try again later.";
    }

    // DOM elements
    const authContainer = document.getElementById("authContainer");
    const chatContainer = document.getElementById("chatContainer");
    const errorMessage = document.getElementById("errorMessage");
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");
    const showRegister = document.getElementById("showRegister");
    const showLogin = document.getElementById("showLogin");
    const loginEmail = document.getElementById("loginEmail");
    const loginPassword = document.getElementById("loginPassword");
    const registerName = document.getElementById("registerName");
    const registerEmail = document.getElementById("registerEmail");
    const registerPassword = document.getElementById("registerPassword");
    const userProfile = document.getElementById("userProfile");
    const userAvatar = document.getElementById("userAvatar");
    const userName = document.getElementById("userName");
    const channelsList = document.getElementById("channelsList");
    const messagesContainer = document.getElementById("messagesContainer");
    const messageInput = document.getElementById("messageInput");
    const currentChannelName = document.getElementById("currentChannelName");
    const channelMembersCount = document.getElementById("channelMembersCount");

    // App state
    let currentUser = null;
    let currentChannel = "general";
    let users = {};

    // Initialize the app
    function initApp() {
      // Switch between login and register forms
      showRegister.addEventListener("click", (e) => {
        e.preventDefault();
        loginForm.style.display = "none";
        registerForm.style.display = "flex";
        errorMessage.textContent = "";
      });

      showLogin.addEventListener("click", (e) => {
        e.preventDefault();
        registerForm.style.display = "none";
        loginForm.style.display = "flex";
        errorMessage.textContent = "";
      });

      // Login form submission
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = loginEmail.value;
        const password = loginPassword.value;
        
        try {
          const userCredential = await auth.signInWithEmailAndPassword(email, password);
          currentUser = userCredential.user;
          await loadUserProfile();
        } catch (error) {
          showError(getFirebaseError(error));
        }
      });

      // Register form submission
      registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = registerName.value;
        const email = registerEmail.value;
        const password = registerPassword.value;
        
        try {
          const userCredential = await auth.createUserWithEmailAndPassword(email, password);
          currentUser = userCredential.user;
          
          // Save additional user info
          await db.ref(`users/${currentUser.uid}`).set({
            name: name,
            email: email,
            createdAt: firebase.database.ServerValue.TIMESTAMP
          });
          
          await loadUserProfile();
        } catch (error) {
          showError(getFirebaseError(error));
        }
      });

      // Message input
      messageInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter" && messageInput.value.trim() !== "") {
          sendMessage(messageInput.value);
          messageInput.value = "";
        }
      });

      // Channel selection
      document.querySelectorAll(".channel").forEach(channel => {
        channel.addEventListener("click", () => {
          selectChannel(channel.dataset.channel);
        });
      });

      // Check auth state
      auth.onAuthStateChanged(async (user) => {
        if (user) {
          // User is signed in
          currentUser = user;
          try {
            await loadUserProfile();
          } catch (error) {
            console.error("Error loading user profile:", error);
            showError("Error loading your profile. Please try again.");
          }
        } else {
          // User is signed out
          currentUser = null;
          authContainer.style.display = "flex";
          chatContainer.style.display = "none";
        }
      });
    }

    // Load user profile
    async function loadUserProfile() {
      try {
        const snapshot = await db.ref(`users/${currentUser.uid}`).once("value");
        const userData = snapshot.val();
        
        if (!userData) {
          throw new Error("User data not found");
        }
        
        // Update UI
        userName.textContent = userData.name || "User";
        userAvatar.textContent = (userData.name || "U").charAt(0).toUpperCase();
        userAvatar.style.backgroundColor = getRandomColor();
        
        // Show chat interface
        authContainer.style.display = "none";
        chatContainer.style.display = "flex";
        
        // Enable message input
        messageInput.disabled = false;
        
        // Load channels and messages
        loadChannels();
        loadMessages();
        
        // Set up presence
        setupPresence();
      } catch (error) {
        console.error("Error loading user profile:", error);
        showError("Error loading your profile. Please try again.");
        await auth.signOut();
      }
    }

    // Set up user presence
    function setupPresence() {
      const userStatusRef = db.ref(`status/${currentUser.uid}`);
      const connectedRef = db.ref(".info/connected");
      
      connectedRef.on("value", (snap) => {
        if (snap.val()) {
          // User is connected
          userStatusRef.onDisconnect().set({
            online: false,
            lastChanged: firebase.database.ServerValue.TIMESTAMP
          });
          
          userStatusRef.set({
            online: true,
            lastChanged: firebase.database.ServerValue.TIMESTAMP,
            name: userName.textContent
          });
        }
      });
    }

    // Load channels
    function loadChannels() {
      // In a real app, you would load these from Firebase
      // For now we're using the static HTML channels
    }

    // Load messages
    function loadMessages() {
      // Clear existing messages (except the first system message)
      messagesContainer.innerHTML = '<div class="system-message">Welcome to the ' + currentChannelName.textContent + ' channel!</div>';
      
      // Load messages from Firebase
      db.ref(`messages/${currentChannel}`).on("child_added", (snapshot) => {
        const message = snapshot.val();
        displayMessage(message);
      });
    }

    // Display a message
    function displayMessage(message) {
      const messageDiv = document.createElement("div");
      messageDiv.className = `message ${message.senderId === currentUser.uid ? "sent" : "received"}`;
      
      const senderName = message.senderId === currentUser.uid ? "You" : (users[message.senderId]?.name || "Unknown");
      const messageTime = new Date(message.timestamp).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
      
      messageDiv.innerHTML = `
        <div class="message-info">
          <div class="message-sender">${senderName}</div>
          <div class="message-time">${messageTime}</div>
        </div>
        <div class="message-content">${message.text}</div>
      `;
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Select a channel
    function selectChannel(channelId) {
      currentChannel = channelId;
      
      // Update UI
      document.querySelectorAll(".channel").forEach(el => {
        el.classList.remove("active");
      });
      document.querySelector(`.channel[data-channel="${channelId}"]`).classList.add("active");
      
      currentChannelName.textContent = channelId.charAt(0).toUpperCase() + channelId.slice(1);
      
      // Load messages for this channel
      loadMessages();
    }

    // Send a message
    function sendMessage(text) {
      if (!text.trim()) return;
      
      db.ref(`messages/${currentChannel}`).push({
        text: text,
        senderId: currentUser.uid,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
    }

    // Show error message
    function showError(message) {
      errorMessage.textContent = message;
      setTimeout(() => {
        errorMessage.textContent = "";
      }, 5000);
    }

    // Get random color for avatar
    function getRandomColor() {
      const colors = ["#6c5ce7", "#00b894", "#0984e3", "#e84393", "#fd79a8", "#fdcb6e"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // Convert Firebase error codes to user-friendly messages
    function getFirebaseError(error) {
      switch (error.code) {
        case 'auth/email-already-in-use':
          return 'This email is already registered.';
        case 'auth/invalid-email':
          return 'Please enter a valid email address.';
        case 'auth/operation-not-allowed':
          return 'Email/password accounts are not enabled.';
        case 'auth/weak-password':
          return 'Password should be at least 6 characters.';
        case 'auth/user-disabled':
          return 'This account has been disabled.';
        case 'auth/user-not-found':
          return 'No account found with this email.';
        case 'auth/wrong-password':
          return 'Incorrect password. Please try again.';
        case 'auth/too-many-requests':
          return 'Too many attempts. Please try again later.';
        default:
          return 'An error occurred. Please try again.';
      }
    }

    // Initialize the app
    document.addEventListener("DOMContentLoaded", () => {
      try {
        initApp();
      } catch (error) {
        console.error("App initialization error:", error);
        showError("Failed to initialize the app. Please refresh the page.");
      }
    });
  </script>
</body>
</html>
