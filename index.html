<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Corporate Conquest</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #00f0ff;
      --secondary: #ff2d75;
      --accent: #00ff9d;
      --bg-dark: #0a0e17;
      --bg-darker: #050811;
      --text: #e0f7ff;
      --text-dim: #8b9cad;
      --warning: #ff9f43;
      --error: #ff5e78;
      --success: #00ff9d;
      --gold: #ffd700;
      --silver: #c0c0c0;
      --bronze: #cd7f32;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Roboto Mono', monospace;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      line-height: 1.6;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 240, 255, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(255, 45, 117, 0.05) 0%, transparent 20%),
        linear-gradient(to bottom, var(--bg-dark), var(--bg-darker));
    }

    /* Animated background elements */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.3) 0.5px, transparent 1px),
        radial-gradient(1px 1px at 90% 80%, rgba(255,255,255,0.3) 0.5px, transparent 1px);
      background-size: 200px 200px;
      z-index: -1;
      animation: starsMove 100s linear infinite;
    }

    @keyframes starsMove {
      from { transform: translateY(0); }
      to { transform: translateY(-200px); }
    }

    /* Container styles */
    .container {
      width: 100%;
      max-width: 900px;
      position: relative;
      padding-bottom: 2rem;
    }

    /* Header styles */
    header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-top: 1rem;
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(2rem, 6vw, 3rem);
      margin-bottom: 0.5rem;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
      letter-spacing: -0.05em;
      text-shadow: 0 0 15px rgba(0, 240, 255, 0.5);
      position: relative;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 50%;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      box-shadow: 0 0 10px var(--primary);
    }

    h2 {
      font-size: 1.5rem;
      margin: 1.5rem 0 1rem;
      color: var(--accent);
      font-weight: 600;
      text-shadow: 0 0 5px var(--accent);
      letter-spacing: 1px;
      border-bottom: 1px solid rgba(0, 255, 157, 0.3);
      padding-bottom: 0.5rem;
    }

    /* Stats display */
    .stats-panel {
      background: rgba(10, 14, 23, 0.8);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
      border: 1px solid rgba(0, 240, 255, 0.2);
      backdrop-filter: blur(8px);
      position: relative;
      overflow: hidden;
    }

    .stats-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      box-shadow: 0 0 10px var(--primary);
    }

    .coins-display {
      font-size: clamp(1.8rem, 6vw, 2.5rem);
      font-weight: bold;
      color: var(--accent);
      letter-spacing: -0.05em;
      text-shadow: 0 0 10px var(--accent);
      font-family: 'Orbitron', sans-serif;
    }

    .income-display {
      color: var(--text-dim);
      font-size: clamp(0.9rem, 3vw, 1.1rem);
      margin-top: 0.5rem;
      display: flex;
      justify-content: space-between;
    }

    /* Click area */
    .click-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
      width: 100%;
      position: relative;
    }

    .click-btn {
      background: linear-gradient(145deg, var(--secondary), #d10058);
      color: white;
      border: none;
      padding: 1.5rem;
      font-size: clamp(1.2rem, 4vw, 1.5rem);
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      max-width: 350px;
      box-shadow: 0 0 25px rgba(255, 45, 117, 0.4);
      font-weight: 700;
      border: 2px solid var(--primary);
      position: relative;
      overflow: hidden;
      z-index: 1;
      font-family: 'Orbitron', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .click-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        45deg, 
        rgba(255,255,255,0.1) 0%, 
        rgba(255,255,255,0.05) 50%, 
        rgba(255,255,255,0.1) 100%
      );
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .click-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 35px rgba(255, 45, 117, 0.6);
    }

    .click-btn:hover::before {
      opacity: 1;
    }

    .click-btn:active {
      transform: translateY(0);
      box-shadow: 0 0 15px rgba(255, 45, 117, 0.3);
    }

    .click-hint {
      color: var(--text-dim);
      font-size: clamp(0.8rem, 3vw, 1rem);
      text-align: center;
      opacity: 0.8;
    }

    /* Upgrades grid */
    .upgrades-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .upgrade-card {
      background: rgba(10, 14, 23, 0.7);
      border-radius: 12px;
      padding: 1.2rem;
      transition: all 0.3s ease;
      border-left: 4px solid var(--secondary);
      border: 1px solid rgba(0, 240, 255, 0.2);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
    }

    .upgrade-card.unlocked {
      cursor: pointer;
      border-left-color: var(--primary);
    }

    .upgrade-card.unlocked:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 240, 255, 0.2);
      background: rgba(10, 14, 23, 0.9);
    }

    .upgrade-card.locked {
      opacity: 0.6;
      border-left-color: var(--text-dim);
    }

    .upgrade-name {
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--primary);
      font-size: clamp(1rem, 3vw, 1.2rem);
      position: relative;
      z-index: 1;
    }

    .upgrade-desc {
      font-size: clamp(0.8rem, 3vw, 0.95rem);
      margin-bottom: 1rem;
      color: var(--text-dim);
      flex-grow: 1;
    }

    .upgrade-cost {
      color: var(--text-dim);
      font-weight: 600;
      font-size: clamp(0.8rem, 3vw, 1rem);
      margin-bottom: 0.5rem;
    }

    .upgrade-owned {
      color: var(--text);
      font-size: clamp(0.8rem, 3vw, 1rem);
      align-self: flex-end;
      margin-top: 0.5rem;
      background: rgba(0, 240, 255, 0.1);
      padding: 0.3rem 0.6rem;
      border-radius: 12px;
    }

    /* Golden upgrades section */
    .golden-upgrades {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .golden-upgrade {
      background: rgba(10, 14, 23, 0.7);
      border-radius: 12px;
      padding: 1.2rem;
      border-left: 4px solid var(--gold);
      border: 1px solid rgba(255, 215, 0, 0.3);
      transition: all 0.3s ease;
    }

    .golden-upgrade.unlocked {
      cursor: pointer;
    }

    .golden-upgrade.unlocked:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
    }

    .golden-upgrade.locked {
      opacity: 0.6;
      border-left-color: var(--text-dim);
    }

    .golden-upgrade-name {
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }

    .golden-upgrade-desc {
      font-size: 0.9rem;
      color: var(--text-dim);
      margin-bottom: 0.8rem;
    }

    .golden-upgrade-cost {
      color: var(--gold);
      font-weight: 600;
    }

    /* Top navigation */
    .top-nav {
      position: absolute;
      top: 0.5rem;
      right: 0;
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
      max-width: 100%;
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-dim);
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 24px;
      cursor: pointer;
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      transition: all 0.2s ease;
      font-weight: 500;
      border: 1px solid rgba(0, 240, 255, 0.2);
      white-space: nowrap;
    }

    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      color: var(--text);
      border-color: var(--primary);
    }

    /* Modals */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(5px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: rgba(10, 14, 23, 0.95);
      border-radius: 16px;
      padding: 2rem;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
      position: relative;
      border: 1px solid var(--primary);
      max-height: 90vh;
      overflow-y: auto;
    }

    .close-modal {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 1.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .close-modal:hover {
      color: var(--text);
      transform: rotate(90deg);
    }

    /* Admin panel styles */
    .admin-panel {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .admin-content {
      background: rgba(10, 14, 23, 0.95);
      border-radius: 16px;
      padding: 2rem;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--primary);
    }

    .admin-title {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: var(--primary);
      text-align: center;
    }

    .user-list {
      max-height: 400px;
      overflow-y: auto;
      margin: 1.5rem 0;
      border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 12px;
    }

    .user-item {
      padding: 1rem;
      border-bottom: 1px solid rgba(0, 240, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .user-actions {
      display: flex;
      gap: 0.5rem;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .ban-btn {
      background: var(--error);
      color: white;
    }

    .unban-btn {
      background: var(--success);
      color: var(--bg-dark);
    }

    /* Leaderboard styles */
    .leaderboard {
      background: rgba(10, 14, 23, 0.8);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(0, 240, 255, 0.2);
    }

    .leaderboard-header {
      display: grid;
      grid-template-columns: 1fr 3fr 2fr 2fr;
      font-weight: bold;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--primary);
    }

    .leaderboard-entries {
      max-height: 400px;
      overflow-y: auto;
    }

    .leaderboard-entry {
      display: grid;
      grid-template-columns: 1fr 3fr 2fr 2fr;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(0, 240, 255, 0.1);
    }

    .leaderboard-refresh {
      text-align: center;
      margin-top: 1rem;
      color: var(--text-dim);
    }

    /* AFK Popup */
    .afk-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(10, 14, 23, 0.95);
      border-radius: 16px;
      padding: 2rem;
      width: 90%;
      max-width: 500px;
      z-index: 3000;
      border: 2px solid var(--accent);
      box-shadow: 0 0 30px rgba(0, 255, 157, 0.5);
      text-align: center;
      display: none;
    }

    .afk-popup h2 {
      color: var(--accent);
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }

    .afk-amount {
      font-size: 2rem;
      color: var(--gold);
      margin: 1rem 0;
      font-weight: bold;
    }

    .afk-time {
      color: var(--text-dim);
      margin-bottom: 1.5rem;
    }

    /* Maintenance banner */
    .maintenance-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--error);
      color: white;
      padding: 1rem;
      text-align: center;
      z-index: 4000;
      display: none;
    }

    /* Animations */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .pulse {
      animation: pulse 0.3s ease;
    }

    @keyframes coin-fall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(calc(100vh + 100px)) rotate(360deg);
        opacity: 0;
      }
    }

    .falling-coin {
      position: absolute;
      width: 40px;
      height: 40px;
      pointer-events: none;
      z-index: 100;
      animation: coin-fall linear forwards;
      filter: drop-shadow(0 0 5px var(--gold));
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .upgrades-grid, .golden-upgrades {
        grid-template-columns: 1fr;
      }
      
      .modal-content {
        padding: 1.5rem;
      }
      
      .admin-content {
        padding: 1rem;
      }
      
      .leaderboard-header,
      .leaderboard-entry {
        grid-template-columns: 1fr 2fr 1fr 1fr;
      }
    }

    @media (max-width: 480px) {
      .top-nav {
        position: static;
        justify-content: center;
        margin-bottom: 1rem;
      }
      
      .click-btn {
        padding: 1.2rem;
      }
      
      .leaderboard-header,
      .leaderboard-entry {
        grid-template-columns: 1fr 1.5fr 1fr 1fr;
        font-size: 0.8rem;
      }
    }
  </style>
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="container">
    <div class="top-nav">
      <!-- Google Sign-In Button -->
      <div id="g_id_onload"
           data-client_id="626223048098-078etpvps2clhd02vs3g5h22sa60537g.apps.googleusercontent.com"
           data-callback="handleGoogleSignIn"
           data-context="signin"
           data-ux_mode="popup"
           data-auto_prompt="false">
      </div>
      <div class="g_id_signin"
           data-type="standard"
           data-size="medium"
           data-theme="filled_blue"
           data-text="sign_in_with"
           data-shape="pill"
           data-logo_alignment="left">
      </div>
      
      <button class="nav-btn" id="adminBtn" style="display: none;">Admin Panel</button>
      <button class="nav-btn" id="signOutBtn" style="display: none;">Sign Out</button>
    </div>
    
    <header>
      <h1>Corporate Conquest</h1>
      <p>Build your business empire from the ground up</p>
    </header>
    
    <div class="stats-panel">
      <div class="coins-display" id="coins">0</div>
      <div class="income-display">
        <span id="cps">0 coins/sec</span>
        <span id="goldenCoins">Golden: 0</span>
      </div>
    </div>
    
    <div class="click-area">
      <button class="click-btn" id="clicker">Earn Coins (1 per click)</button>
      <div class="click-hint">(Click or press SPACE - no holding!)</div>
    </div>
    
    <h2>Business Ventures</h2>
    <div class="upgrades-grid" id="upgrades"></div>
    
    <h2>Golden Investments</h2>
    <div class="golden-upgrades" id="goldenUpgrades"></div>
    
    <h2>Global Leaderboard</h2>
    <div class="leaderboard" id="leaderboard">
      <div class="leaderboard-header">
        <span>Rank</span>
        <span>Player</span>
        <span>Coins</span>
        <span>Golden</span>
      </div>
      <div class="leaderboard-entries" id="leaderboardEntries">
        <div style="text-align: center; padding: 1rem;">Loading leaderboard...</div>
      </div>
      <div class="leaderboard-refresh">
        Next update in: <span id="refreshTimer">10:00</span>
      </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="admin-panel" id="adminPanel">
      <div class="admin-content">
        <button class="close-modal" id="closeAdmin">&times;</button>
        <h2 class="admin-title">Admin Panel</h2>
        <div class="user-list" id="userList">
          <div style="text-align: center; padding: 2rem;">Loading users...</div>
        </div>
        <div style="text-align: center; margin-top: 1rem;">
          <button class="action-btn" id="refreshUsers">Refresh List</button>
          <button class="action-btn" id="toggleMaintenance" style="background: var(--warning);">Enable Maintenance</button>
        </div>
      </div>
    </div>

    <!-- AFK Earnings Popup -->
    <div class="afk-popup" id="afkPopup">
      <h2>⚡ WELCOME BACK! ⚡</h2>
      <p>You earned:</p>
      <div class="afk-amount" id="afkAmount">0</div>
      <p>While you were away for:</p>
      <div class="afk-time" id="afkTime">0 minutes 0 seconds</div>
      <button class="click-btn" id="closeAfkPopup" style="max-width: 200px;">Continue</button>
    </div>

    <!-- Sign In Required Modal -->
    <div class="modal-overlay" id="signinModal">
      <div class="modal-content">
        <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--primary);">Sign In Required</h2>
        <p style="text-align: center; margin-bottom: 2rem;">Please sign in with Google to play Corporate Conquest.</p>
        <div style="display: flex; justify-content: center;">
          <div class="g_id_signin"
               data-type="standard"
               data-size="large"
               data-theme="filled_blue"
               data-text="sign_in_with"
               data-shape="rectangular"
               data-logo_alignment="left">
          </div>
        </div>
      </div>
    </div>

    <!-- Maintenance Banner -->
    <div class="maintenance-banner" id="maintenanceBanner">
      <h2>🚧 Maintenance Ongoing 🚧</h2>
      <p id="maintenanceMessage">The game is currently undergoing maintenance. Please check back later.</p>
    </div>
  </div>

  <script>
    // ======================
    // GAME STATE
    // ======================
    let gameState = {
      coins: 0,
      coinsPerClick: 1,
      coinsPerSecond: 0,
      goldenCoins: 0,
      rebirthCount: 0,
      highestVisibleUpgrade: 3,
      upgrades: [
        { id: 1, name: "Lemonade Stand", baseCost: 10, owned: 0, effect: 0.5, desc: "Basic street business" },
        { id: 2, name: "Freelance Work", baseCost: 50, owned: 0, effect: 2, desc: "Offer your skills online" },
        { id: 3, name: "Etsy Shop", baseCost: 100, owned: 0, effect: 3, desc: "Sell handmade crafts" },
        { id: 4, name: "Dropshipping", baseCost: 200, owned: 0, effect: 5, desc: "Sell without inventory" },
        { id: 5, name: "Local Store", baseCost: 500, owned: 0, effect: 8, desc: "Brick and mortar shop" },
        { id: 6, name: "E-commerce", baseCost: 1000, owned: 0, effect: 12, desc: "Online retail empire" },
        { id: 7, name: "Franchise", baseCost: 2000, owned: 0, effect: 18, desc: "Expand your brand" },
        { id: 8, name: "Tech Startup", baseCost: 5000, owned: 0, effect: 25, desc: "Innovate and disrupt" },
        { id: 9, name: "Manufacturing", baseCost: 10000, owned: 0, effect: 35, desc: "Produce at scale" },
        { id: 10, name: "Conglomerate", baseCost: 20000, owned: 0, effect: 50, desc: "Diversify holdings" },
        { id: 11, name: "Mega Corp", baseCost: 50000, owned: 0, effect: 75, desc: "Dominate industries" },
        { id: 12, name: "Space Mining", baseCost: 100000, owned: 0, effect: 100, desc: "Harvest asteroids" },
        { id: 13, name: "AI Overlord", baseCost: 250000, owned: 0, effect: 150, desc: "Automate everything" },
        { id: 14, name: "Galactic Empire", baseCost: 500000, owned: 0, effect: 225, desc: "Rule star systems" },
        { id: 15, name: "Time Monopoly", baseCost: 1000000, owned: 0, effect: 350, desc: "Control history itself" },
        { id: 16, name: "Omniversal Corp", baseCost: 5000000, owned: 0, effect: 600, desc: "Span all realities" },
        { id: 17, name: "The Singularity", baseCost: 10000000, owned: 0, effect: 1000, desc: "Become pure energy" },
        { id: 18, name: "Rebirth", baseCost: 100000000, owned: 0, effect: 0, desc: "Start anew with golden coins" }
      ],
      goldenUpgrades: [
        { id: 1, name: "+10% CPS", cost: 1, purchased: false, effect: 1.1 },
        { id: 2, name: "+25% CPS", cost: 2, purchased: false, effect: 1.25 },
        { id: 3, name: "+50% CPS", cost: 3, purchased: false, effect: 1.5 },
        { id: 4, name: "Double Clicks", cost: 5, purchased: false, effect: 2.0, clickEffect: true },
        { id: 5, name: "+100% CPS", cost: 7, purchased: false, effect: 2.0 },
        { id: 6, name: "Triple Clicks", cost: 10, purchased: false, effect: 3.0, clickEffect: true },
        { id: 7, name: "+150% CPS", cost: 15, purchased: false, effect: 2.5 },
        { id: 8, name: "5x Clicks", cost: 20, purchased: false, effect: 5.0, clickEffect: true },
        { id: 9, name: "+200% CPS", cost: 30, purchased: false, effect: 3.0 },
        { id: 10, name: "10x Clicks", cost: 40, purchased: false, effect: 10.0, clickEffect: true },
        { id: 11, name: "+300% CPS", cost: 50, purchased: false, effect: 4.0 },
        { id: 12, name: "20x Clicks", cost: 60, purchased: false, effect: 20.0, clickEffect: true },
        { id: 13, name: "+500% CPS", cost: 75, purchased: false, effect: 6.0 },
        { id: 14, name: "50x Clicks", cost: 90, purchased: false, effect: 50.0, clickEffect: true },
        { id: 15, name: "+750% CPS", cost: 110, purchased: false, effect: 8.5 },
        { id: 16, name: "100x Clicks", cost: 130, purchased: false, effect: 100.0, clickEffect: true },
        { id: 17, name: "+1000% CPS", cost: 150, purchased: false, effect: 11.0 },
        { id: 18, name: "200x Clicks", cost: 175, purchased: false, effect: 200.0, clickEffect: true },
        { id: 19, name: "+1500% CPS", cost: 200, purchased: false, effect: 16.0 }
      ],
      user: {
        id: "",
        name: "Guest",
        email: "",
        picture: "",
        isAdmin: false
      },
      lastClickTime: 0,
      spaceCooldown: false,
      lastActiveTimestamp: Date.now()
    };

    // ======================
    // JSONBIN INTEGRATION
    // ======================
    const JSONBIN_ID = '68221c308561e97a50126b52';
    const X_MASTER_KEY = '$2a$10$sJr7V0Jt993U7BEW4PQauO7BIApPMWnvGtuSSFinCVdgCJoG543fG';
    let globalGameData = {
      bans: [],
      leaderboard: [],
      gameStatus: {
        maintenance: false,
        maintenanceMessage: "",
        lastGlobalRefresh: new Date().toISOString()
      },
      playerData: {}
    };

    // ======================
    // GAME FUNCTIONS
    // ======================
    function gameLoop() {
      gameState.coins += gameState.coinsPerSecond;
      updateDisplay();
      checkForNewUpgrades();
      renderUpgrades();
      renderGoldenUpgrades();
      saveGame();
    }

    function handleClick() {
      const now = Date.now();
      
      // Space bar cooldown - only allow one click every 2 seconds if holding
      if (gameState.spaceCooldown && now - gameState.lastClickTime < 2000) {
        return;
      }
      
      gameState.coins += gameState.coinsPerClick;
      gameState.lastClickTime = now;
      gameState.lastActiveTimestamp = now;
      
      // Create visual feedback
      createFallingCoin();
      document.getElementById("coins").classList.add("pulse");
      setTimeout(() => document.getElementById("coins").classList.remove("pulse"), 300);
      
      updateDisplay();
      saveGame();
    }

    function createFallingCoin() {
      const coin = document.createElement('img');
      coin.className = 'falling-coin';
      coin.src = 'https://cdn-icons-png.flaticon.com/512/272/272525.png';
      
      // Random position and animation
      const xPos = Math.random() * 100;
      const duration = 2 + Math.random() * 2;
      const size = 30 + Math.random() * 20;
      
      coin.style.left = `${xPos}%`;
      coin.style.width = `${size}px`;
      coin.style.height = `${size}px`;
      coin.style.animationDuration = `${duration}s`;
      
      document.body.appendChild(coin);
      
      // Remove after animation
      setTimeout(() => coin.remove(), duration * 1000);
    }

    function updateDisplay() {
      document.getElementById("coins").textContent = Math.floor(gameState.coins).toLocaleString();
      document.getElementById("cps").textContent = `${gameState.coinsPerSecond.toFixed(1)} coins/sec`;
      document.getElementById("goldenCoins").textContent = `Golden: ${gameState.goldenCoins}`;
      document.getElementById("clicker").textContent = `Earn Coins (${gameState.coinsPerClick.toLocaleString()} per click)`;
    }

    function checkForNewUpgrades() {
      for (let i = 0; i < gameState.upgrades.length; i++) {
        const upgrade = gameState.upgrades[i];
        const cost = getUpgradeCost(upgrade);
        
        if (i > gameState.highestVisibleUpgrade && gameState.coins >= cost * 0.25) {
          gameState.highestVisibleUpgrade = i;
          renderUpgrades();
        }
      }
    }

    function renderUpgrades() {
      const container = document.getElementById("upgrades");
      container.innerHTML = "";
      
      const visibleUpgrades = gameState.upgrades.slice(0, gameState.highestVisibleUpgrade + 1);
      
      visibleUpgrades.forEach(upgrade => {
        const cost = getUpgradeCost(upgrade);
        const canAfford = gameState.coins >= cost;
        
        const upgradeEl = document.createElement("div");
        upgradeEl.className = `upgrade-card ${canAfford ? "unlocked" : "locked"}`;
        upgradeEl.setAttribute('data-id', upgrade.id);
        
        upgradeEl.innerHTML = `
          <div class="upgrade-name">${upgrade.name}</div>
          <div class="upgrade-desc">${upgrade.desc}</div>
          <div class="upgrade-cost">${cost.toLocaleString()} coins</div>
          <div class="upgrade-owned">Owned: ${upgrade.owned}</div>
        `;
        
        container.appendChild(upgradeEl);
      });
    }

    function renderGoldenUpgrades() {
      const container = document.getElementById("goldenUpgrades");
      container.innerHTML = "";
      
      gameState.goldenUpgrades.forEach(upgrade => {
        const canAfford = gameState.goldenCoins >= upgrade.cost && !upgrade.purchased;
        
        const upgradeEl = document.createElement("div");
        upgradeEl.className = `golden-upgrade ${canAfford ? "unlocked" : "locked"}`;
        upgradeEl.setAttribute('data-id', upgrade.id);
        
        upgradeEl.innerHTML = `
          <div class="golden-upgrade-name">${upgrade.name}</div>
          <div class="golden-upgrade-desc">${upgrade.clickEffect ? 
            `Multiplies click power by ${upgrade.effect}` : 
            `Multiplies CPS by ${upgrade.effect}`}
          </div>
          <div class="golden-upgrade-cost">${upgrade.cost} golden coins</div>
          ${upgrade.purchased ? '<div style="color: var(--gold); margin-top: 0.5rem;">Purchased</div>' : ''}
        `;
        
        container.appendChild(upgradeEl);
      });
    }

    function buyUpgrade(id) {
      const upgrade = gameState.upgrades.find(u => u.id === id);
      const cost = getUpgradeCost(upgrade);
      
      if (gameState.coins >= cost) {
        gameState.coins -= cost;
        upgrade.owned++;
        
        // Special handling for Rebirth upgrade
        if (upgrade.name === "Rebirth") {
          triggerRebirth();
          return;
        }
        
        gameState.coinsPerSecond += upgrade.effect;
        updateDisplay();
        renderUpgrades();
        saveGame();
      }
    }

    function buyGoldenUpgrade(id) {
      const upgrade = gameState.goldenUpgrades.find(u => u.id === id);
      
      if (!upgrade.purchased && gameState.goldenCoins >= upgrade.cost) {
        gameState.goldenCoins -= upgrade.cost;
        upgrade.purchased = true;
        
        if (upgrade.clickEffect) {
          gameState.coinsPerClick *= upgrade.effect;
        } else {
          gameState.coinsPerSecond *= upgrade.effect;
        }
        
        updateDisplay();
        renderGoldenUpgrades();
        saveGame();
      }
    }

    function triggerRebirth() {
      const coinsEarned = Math.min(gameState.rebirthCount + 1, 7);
      gameState.goldenCoins += coinsEarned;
      gameState.rebirthCount++;
      
      // Visual feedback
      for (let i = 0; i < 20; i++) {
        setTimeout(() => createFallingCoin(), i * 100);
      }
      
      alert(`Rebirth complete! Earned ${coinsEarned} golden coins!`);
      updateDisplay();
      saveGame();
    }

    function getUpgradeCost(upgrade) {
      return Math.floor(upgrade.baseCost * Math.pow(1.5, upgrade.owned));
    }

    // ======================
    // JSONBIN FUNCTIONS
    // ======================
    async function fetchGlobalData() {
      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}/latest`, {
          headers: { 'X-Master-Key': X_MASTER_KEY }
        });
        const data = await response.json();
        globalGameData = data.record || globalGameData;
        
        // Check maintenance mode
        if (globalGameData.gameStatus?.maintenance) {
          showMaintenanceMessage(globalGameData.gameStatus);
          return false;
        }
        
        return true;
      } catch (error) {
        console.error('Failed to fetch global data:', error);
        return false;
      }
    }

    async function pushPlayerData() {
      if (!gameState.user.id || globalGameData.gameStatus?.maintenance) return;

      const playerData = {
        coins: gameState.coins,
        goldenCoins: gameState.goldenCoins,
        rebirths: gameState.rebirthCount,
        upgrades: gameState.upgrades,
        lastLogin: new Date().toISOString()
      };

      try {
        // Update leaderboard if player has enough coins
        const leaderboardEntry = {
          userId: gameState.user.id,
          username: gameState.user.name,
          coins: gameState.coins,
          goldenCoins: gameState.goldenCoins,
          rebirths: gameState.rebirthCount,
          lastUpdated: new Date().toISOString()
        };

        // Check if player already exists in leaderboard
        const existingIndex = globalGameData.leaderboard.findIndex(entry => entry.userId === gameState.user.id);
        if (existingIndex >= 0) {
          globalGameData.leaderboard[existingIndex] = leaderboardEntry;
        } else {
          globalGameData.leaderboard.push(leaderboardEntry);
        }

        // Sort leaderboard by coins
        globalGameData.leaderboard.sort((a, b) => b.coins - a.coins);

        // Update player data
        globalGameData.playerData[gameState.user.id] = playerData;

        await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': X_MASTER_KEY
          },
          body: JSON.stringify(globalGameData)
        });
      } catch (error) {
        console.error('Failed to save player data:', error);
      }
    }

    // ======================
    // LEADERBOARD SYSTEM
    // ======================
    function startLeaderboardTimer() {
      const nextUpdate = Math.ceil(Date.now() / 600000) * 600000; // Next 10-minute mark
      const updateTimer = () => {
        const remaining = Math.max(nextUpdate - Date.now(), 0);
        const minutes = Math.floor(remaining / 60000);
        const seconds = Math.floor((remaining % 60000) / 1000);
        document.getElementById('refreshTimer').textContent = 
          `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (remaining <= 0) {
          updateLeaderboard();
          startLeaderboardTimer(); // Reset timer for next 10 minutes
        }
      };
      
      updateTimer();
      setInterval(updateTimer, 1000);
    }

    async function updateLeaderboard() {
      try {
        await fetchGlobalData();
        const entries = globalGameData.leaderboard
          .sort((a, b) => b.coins - a.coins)
          .slice(0, 100);

        const container = document.getElementById('leaderboardEntries');
        container.innerHTML = '';

        if (entries.length === 0) {
          container.innerHTML = '<div style="text-align: center; padding: 1rem;">No players yet!</div>';
          return;
        }

        entries.forEach((entry, index) => {
          const entryEl = document.createElement('div');
          entryEl.className = 'leaderboard-entry';
          entryEl.innerHTML = `
            <span>#${index + 1}</span>
            <span>${entry.username}</span>
            <span>${entry.coins.toLocaleString()}</span>
            <span>${entry.goldenCoins}</span>
          `;
          container.appendChild(entryEl);
        });

        // Update last refresh time
        globalGameData.gameStatus.lastGlobalRefresh = new Date().toISOString();
        await pushPlayerData();
      } catch (error) {
        console.error('Failed to update leaderboard:', error);
      }
    }

    // ======================
    // AFK EARNINGS SYSTEM
    // ======================
    function setupAfkTracking() {
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          gameState.lastActiveTimestamp = Date.now();
        } else {
          calculateAfkEarnings();
        }
      });

      window.addEventListener('blur', () => {
        gameState.lastActiveTimestamp = Date.now();
      });

      window.addEventListener('focus', () => {
        calculateAfkEarnings();
      });
    }

    function calculateAfkEarnings() {
      const afkSeconds = Math.min((Date.now() - gameState.lastActiveTimestamp) / 1000, 3600);
      if (afkSeconds < 5) return; // Ignore very short AFK periods
      
      const earnings = Math.floor(gameState.coinsPerSecond * 0.25 * afkSeconds);
      
      if (earnings > 0) {
        gameState.coins += earnings;
        showAfkPopup(earnings, afkSeconds);
        saveGame();
        updateDisplay();
      }
    }

    function showAfkPopup(earnings, seconds) {
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = Math.floor(seconds % 60);
      
      document.getElementById('afkAmount').textContent = earnings.toLocaleString();
      document.getElementById('afkTime').textContent = `${minutes} minutes ${remainingSeconds} seconds`;
      document.getElementById('afkPopup').style.display = 'block';
    }

    // ======================
    // MAINTENANCE MODE
    // ======================
    function showMaintenanceMessage(status) {
      const banner = document.getElementById('maintenanceBanner');
      const message = document.getElementById('maintenanceMessage');
      
      if (status.maintenance) {
        banner.style.display = 'block';
        message.textContent = status.message || "The game is currently undergoing maintenance. Please check back later.";
      } else {
        banner.style.display = 'none';
      }
    }

    async function toggleMaintenanceMode() {
      const btn = document.getElementById('toggleMaintenance');
      globalGameData.gameStatus.maintenance = !globalGameData.gameStatus.maintenance;
      
      if (globalGameData.gameStatus.maintenance) {
        globalGameData.gameStatus.maintenanceMessage = prompt("Enter maintenance message:", "The game is currently undergoing maintenance. Please check back later.");
        btn.textContent = "Disable Maintenance";
        btn.style.background = "var(--success)";
      } else {
        btn.textContent = "Enable Maintenance";
        btn.style.background = "var(--warning)";
      }
      
      try {
        await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': X_MASTER_KEY
          },
          body: JSON.stringify(globalGameData)
        });
        
        showMaintenanceMessage(globalGameData.gameStatus);
      } catch (error) {
        console.error('Failed to update maintenance mode:', error);
      }
    }

    // ======================
    // AUTHENTICATION
    // ======================
    function handleGoogleSignIn(response) {
      try {
        const userData = parseJWT(response.credential);
        
        gameState.user = {
          id: userData.sub,
          name: userData.name,
          email: userData.email,
          picture: userData.picture,
          isAdmin: userData.email === "yhpatel@lcstudents.com"
        };
        
        // Hide sign-in button, show sign-out
        document.querySelector('.g_id_signin').style.display = 'none';
        document.getElementById('signOutBtn').style.display = 'block';
        
        // Show admin button if admin
        if (gameState.user.isAdmin) {
          document.getElementById('adminBtn').style.display = 'block';
        }
        
        // Close sign-in modal
        document.getElementById('signinModal').style.display = 'none';
        
        // Initialize game systems
        initializeGame();
      } catch (error) {
        console.error("Error handling sign-in:", error);
      }
    }

    function signOut() {
      google.accounts.id.disableAutoSelect();
      gameState.user = { id: "", name: "Guest", email: "", picture: "", isAdmin: false };
      
      document.querySelector('.g_id_signin').style.display = 'block';
      document.getElementById('signOutBtn').style.display = 'none';
      document.getElementById('adminBtn').style.display = 'none';
      
      // Show sign-in modal
      document.getElementById('signinModal').style.display = 'flex';
    }

    function parseJWT(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      return JSON.parse(atob(base64));
    }

    // ======================
    // ADMIN PANEL
    // ======================
    function showAdminPanel() {
      document.getElementById('adminPanel').style.display = 'flex';
      loadUserList();
    }

    function loadUserList() {
      const userList = document.getElementById('userList');
      userList.innerHTML = '<div style="text-align: center; padding: 2rem;">Loading users...</div>';
      
      // In a real app, this would fetch from a database
      // For demo, we'll just show current user
      setTimeout(() => {
        userList.innerHTML = `
          <div class="user-item">
            <div class="user-info">
              <img src="${gameState.user.picture}" class="user-avatar" alt="${gameState.user.name}">
              <div>
                <div>${gameState.user.name}</div>
                <div style="font-size: 0.8rem; color: var(--text-dim);">${gameState.user.email}</div>
              </div>
            </div>
            <div class="user-actions">
              <button class="action-btn ban-btn">Ban</button>
            </div>
          </div>
        `;
      }, 1000);
    }

    // ======================
    // SAVE/LOAD SYSTEM
    // ======================
    async function saveGame() {
      if (!gameState.user.id) return;
      
      // Local save
      localStorage.setItem(`corporateConquest_${gameState.user.id}`, JSON.stringify(gameState));
      
      // Cloud save every 2 minutes
      const now = Date.now();
      if (!this.lastCloudSave || now - this.lastCloudSave > 120000) {
        await pushPlayerData();
        this.lastCloudSave = now;
      }
    }

    async function loadGame() {
      if (!gameState.user.id) return;
      
      // Try cloud load first
      if (await fetchGlobalData()) {
        const cloudData = globalGameData.playerData[gameState.user.id];
        if (cloudData) {
          // Merge cloud data with local state
          gameState.coins = cloudData.coins || gameState.coins;
          gameState.goldenCoins = cloudData.goldenCoins || gameState.goldenCoins;
          gameState.rebirthCount = cloudData.rebirths || gameState.rebirthCount;
          
          // Merge upgrades
          if (cloudData.upgrades) {
            cloudData.upgrades.forEach(savedUpgrade => {
              const existing = gameState.upgrades.find(u => u.id === savedUpgrade.id);
              if (existing) {
                existing.owned = savedUpgrade.owned || 0;
              }
            });
          }
          
          // Recalculate CPS
          gameState.coinsPerSecond = gameState.upgrades.reduce((total, upgrade) => {
            return total + (upgrade.effect * upgrade.owned);
          }, 0);
          
          // Apply golden upgrades
          gameState.goldenUpgrades.forEach(upgrade => {
            if (upgrade.purchased) {
              if (upgrade.clickEffect) {
                gameState.coinsPerClick *= upgrade.effect;
              } else {
                gameState.coinsPerSecond *= upgrade.effect;
              }
            }
          });
        }
      }
      
      // Fallback to local storage
      const localData = localStorage.getItem(`corporateConquest_${gameState.user.id}`);
      if (localData) {
        const data = JSON.parse(localData);
        gameState.coins = data.coins || gameState.coins;
        gameState.coinsPerClick = data.coinsPerClick || gameState.coinsPerClick;
        gameState.coinsPerSecond = data.coinsPerSecond || gameState.coinsPerSecond;
        gameState.goldenCoins = data.goldenCoins || gameState.goldenCoins;
        gameState.rebirthCount = data.rebirthCount || gameState.rebirthCount;
        gameState.highestVisibleUpgrade = data.highestVisibleUpgrade || 3;
        
        // Merge upgrades
        if (data.upgrades) {
          data.upgrades.forEach(savedUpgrade => {
            const existing = gameState.upgrades.find(u => u.id === savedUpgrade.id);
            if (existing) {
              existing.owned = savedUpgrade.owned || 0;
            }
          });
        }
        
        // Merge golden upgrades
        if (data.goldenUpgrades) {
          data.goldenUpgrades.forEach(savedUpgrade => {
            const existing = gameState.goldenUpgrades.find(u => u.id === savedUpgrade.id);
            if (existing) {
              existing.purchased = savedUpgrade.purchased || false;
            }
          });
        }
      } else {
        // New player bonus
        gameState.goldenCoins += 3;
      }
      
      updateDisplay();
      renderUpgrades();
      renderGoldenUpgrades();
    }

    // ======================
    // INITIALIZATION
    // ======================
    async function initializeGame() {
      // Load game data
      await loadGame();
      
      // Start game systems
      setupAfkTracking();
      startLeaderboardTimer();
      updateLeaderboard();
      
      // Start game loop
      setInterval(gameLoop, 1000);
      
      // Auto-refresh every 10 minutes
      setInterval(async () => {
        await fetchGlobalData();
        updateLeaderboard();
      }, 600000);
    }

    // ======================
    // EVENT LISTENERS
    // ======================
    document.addEventListener('DOMContentLoaded', () => {
      // Check if signed in
      const savedUser = localStorage.getItem('googleUser');
      if (!savedUser) {
        document.getElementById('signinModal').style.display = 'flex';
      }
      
      // Button listeners
      document.getElementById('clicker').addEventListener('click', handleClick);
      document.getElementById('signOutBtn').addEventListener('click', signOut);
      document.getElementById('adminBtn').addEventListener('click', showAdminPanel);
      document.getElementById('closeAdmin').addEventListener('click', () => {
        document.getElementById('adminPanel').style.display = 'none';
      });
      document.getElementById('closeAfkPopup').addEventListener('click', () => {
        document.getElementById('afkPopup').style.display = 'none';
      });
      document.getElementById('refreshUsers').addEventListener('click', loadUserList);
      document.getElementById('toggleMaintenance').addEventListener('click', toggleMaintenanceMode);
      
      // Space bar handling
      document.addEventListener('keydown', (e) => {
        if (e.code === "Space") {
          e.preventDefault();
          handleClick();
          gameState.spaceCooldown = true;
        }
      });
      
      document.addEventListener('keyup', (e) => {
        if (e.code === "Space") {
          gameState.spaceCooldown = false;
        }
      });
      
      // Upgrade click handlers
      document.addEventListener('click', (e) => {
        if (e.target.closest('.upgrade-card.unlocked')) {
          const id = parseInt(e.target.closest('.upgrade-card').getAttribute('data-id'));
          buyUpgrade(id);
        }
        
        if (e.target.closest('.golden-upgrade.unlocked')) {
          const id = parseInt(e.target.closest('.golden-upgrade').getAttribute('data-id'));
          buyGoldenUpgrade(id);
        }
      });
    });
  </script>
</body>
</html>
