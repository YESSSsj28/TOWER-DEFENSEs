<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quantum Tycoon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Quantum Cyberpunk Theme */
    :root {
      --quantum-blue: #00f0ff;
      --neon-purple: #b400ff;
      --matrix-green: #00ff41;
      --dark-bg: #0a0a1a;
      --darker-bg: #050510;
      --card-bg: rgba(20, 20, 40, 0.8);
      --text: #e0e0ff;
      --gold: #ffd700;
      --error: #ff2a6d;
      --success: #00ff9d;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Roboto Mono', monospace;
      background: var(--dark-bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      line-height: 1.6;
      touch-action: manipulation;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 240, 255, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(180, 0, 255, 0.05) 0%, transparent 20%),
        linear-gradient(to bottom, var(--dark-bg), var(--darker-bg));
    }
    
    /* Animated quantum particles background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(1px 1px at 10% 20%, var(--quantum-blue) 0.5px, transparent 1px),
        radial-gradient(1px 1px at 90% 80%, var(--neon-purple) 0.5px, transparent 1px),
        radial-gradient(1px 1px at 30% 50%, var(--matrix-green) 0.5px, transparent 1px),
        radial-gradient(1px 1px at 70% 10%, white 0.5px, transparent 1px);
      background-size: 200px 200px;
      z-index: -1;
      animation: particlesMove 100s linear infinite;
    }
    
    @keyframes particlesMove {
      from { transform: translateY(0); }
      to { transform: translateY(-200px); }
    }
    
    .container {
      width: 100%;
      max-width: 800px;
      position: relative;
      padding-bottom: 2rem;
    }
    
    header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-top: 1rem;
    }
    
    h1 {
      font-size: clamp(1.8rem, 5vw, 2.5rem);
      margin-bottom: 0.5rem;
      background: linear-gradient(90deg, var(--quantum-blue), var(--neon-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
      letter-spacing: -0.05em;
      text-shadow: 0 0 10px rgba(0, 240, 255, 0.3);
      position: relative;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 50%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--neon-purple), transparent);
      box-shadow: 0 0 10px var(--neon-purple);
    }
    
    h2 {
      font-size: 1.25rem;
      margin: 1.5rem 0 1rem;
      color: var(--matrix-green);
      font-weight: 600;
      text-shadow: 0 0 5px var(--matrix-green);
      letter-spacing: 1px;
    }
    
    /* Quantum Stats Panel */
    .stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card-bg);
      padding: 1.25rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
      width: 100%;
      border: 1px solid rgba(0, 240, 255, 0.2);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
    }
    
    .stats::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--quantum-blue), var(--neon-purple));
      box-shadow: 0 0 10px var(--quantum-blue);
    }
    
    .quantum-display {
      font-size: clamp(1.5rem, 5vw, 2rem);
      font-weight: bold;
      color: var(--matrix-green);
      letter-spacing: -0.05em;
      text-shadow: 0 0 10px var(--matrix-green);
      font-family: 'Roboto Mono', monospace;
    }
    
    .qps-display {
      color: rgba(224, 224, 255, 0.7);
      font-size: clamp(0.8rem, 3vw, 1rem);
      margin-top: 0.25rem;
      font-family: 'Roboto Mono', monospace;
    }
    
    .entanglement-display {
      color: var(--gold);
      font-size: clamp(0.8rem, 3vw, 1rem);
      margin-top: 0.25rem;
      font-weight: 600;
      text-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
      font-family: 'Roboto Mono', monospace;
    }
    
    /* Quantum Clicker */
    .click-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
      width: 100%;
      position: relative;
    }
    
    .quantum-btn {
      background: linear-gradient(145deg, var(--quantum-blue), var(--neon-purple));
      color: white;
      border: none;
      padding: 1.25rem;
      font-size: clamp(1rem, 4vw, 1.2rem);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      max-width: 300px;
      box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
      font-weight: 600;
      border: 1px solid var(--matrix-green);
      position: relative;
      overflow: hidden;
      z-index: 1;
      font-family: 'Roboto Mono', monospace;
    }
    
    .quantum-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(0, 240, 255, 0.5);
    }
    
    .quantum-btn:active {
      transform: translateY(0);
      box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
    }
    
    /* Quantum Upgrades Grid */
    .upgrades-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
      width: 100%;
    }
    
    .quantum-upgrade {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1rem;
      transition: all 0.2s ease;
      border-left: 3px solid var(--quantum-blue);
      font-size: clamp(0.8rem, 3vw, 1rem);
      border: 1px solid rgba(0, 240, 255, 0.2);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
    }
    
    .quantum-upgrade.unlocked {
      cursor: pointer;
    }
    
    .quantum-upgrade.unlocked:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
      background: rgba(20, 20, 40, 0.9);
      border-color: var(--matrix-green);
    }
    
    .quantum-upgrade.locked {
      opacity: 0.5;
      border-left-color: rgba(255, 255, 255, 0.1);
    }
    
    .upgrade-name {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--matrix-green);
      font-size: clamp(0.9rem, 3vw, 1rem);
      position: relative;
      z-index: 1;
    }
    
    .upgrade-desc {
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      margin-bottom: 0.75rem;
      color: rgba(224, 224, 255, 0.7);
      flex-grow: 1;
      position: relative;
      z-index: 1;
    }
    
    .upgrade-cost {
      color: rgba(224, 224, 255, 0.7);
      font-weight: 600;
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 1;
    }
    
    .upgrade-owned {
      color: var(--text);
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      align-self: flex-end;
      position: relative;
      z-index: 1;
    }
    
    /* Quantum Effects */
    @keyframes quantumPulse {
      0% { transform: scale(1); box-shadow: 0 0 10px var(--quantum-blue); }
      50% { transform: scale(1.05); box-shadow: 0 0 20px var(--neon-purple); }
      100% { transform: scale(1); box-shadow: 0 0 10px var(--quantum-blue); }
    }
    
    .quantum-pulse {
      animation: quantumPulse 0.5s ease;
    }
    
    /* Quantum Particles Animation */
    .quantum-particle {
      position: absolute;
      width: 40px;
      height: 40px;
      pointer-events: none;
      z-index: 100;
      animation: quantumFall linear forwards;
      filter: drop-shadow(0 0 5px var(--quantum-blue));
    }
    
    @keyframes quantumFall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(calc(100vh + 100px)) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Top Navigation */
    .quantum-nav {
      position: absolute;
      top: 0.5rem;
      right: 0;
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
      max-width: 100%;
    }
    
    .nav-btn {
      background: rgba(0, 240, 255, 0.1);
      color: var(--text);
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      transition: all 0.2s ease;
      margin-bottom: 0.5rem;
      font-weight: 500;
      border: 1px solid rgba(0, 240, 255, 0.3);
      white-space: nowrap;
      font-family: 'Roboto Mono', monospace;
    }
    
    .nav-btn:hover {
      background: rgba(0, 240, 255, 0.2);
      border-color: var(--matrix-green);
    }
    
    #signOutBtn {
      display: none;
      background: var(--neon-purple);
      color: white;
    }
    
    #adminBtn {
      display: none;
      background: var(--matrix-green);
      color: var(--dark-bg);
    }
    
    /* Google Sign-In */
    #g_id_onload {
      display: none;
    }
    
    .g_id_signin {
      border: none !important;
      background: #4285F4 !important;
      color: white !important;
      border-radius: 20px !important;
      height: 38px !important;
      padding: 0 16px !important;
      margin-bottom: 0.5rem;
      transition: all 0.2s ease !important;
    }
    
    /* User Profile */
    .quantum-profile {
      display: none;
      align-items: center;
      gap: 8px;
      margin-bottom: 0.5rem;
      background: rgba(0, 240, 255, 0.1);
      padding: 0.5rem 0.75rem;
      border-radius: 20px;
      border: 1px solid rgba(0, 240, 255, 0.3);
    }
    
    .profile-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .profile-name {
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      color: var(--text);
      font-weight: 500;
    }
    
    /* Quantum Modals */
    .quantum-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(5px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: quantumFadeIn 0.3s ease;
    }
    
    .modal-content {
      background: var(--card-bg);
      padding: 1.75rem;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      position: relative;
      border: 1px solid var(--quantum-blue);
      animation: quantumSlideUp 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    @keyframes quantumFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes quantumSlideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .close-modal {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      color: rgba(224, 224, 255, 0.7);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      transition: all 0.2s;
    }
    
    .close-modal:hover {
      color: var(--text);
      transform: rotate(90deg);
    }
    
    /* Admin Panel */
    .admin-panel {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    
    .admin-content {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--quantum-blue);
    }
    
    .admin-title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: var(--matrix-green);
      text-align: center;
    }
    
    .admin-user-list {
      max-height: 300px;
      overflow-y: auto;
      margin: 1.5rem 0;
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 8px;
    }
    
    .admin-user {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(0, 240, 255, 0.2);
    }
    
    .admin-user:last-child {
      border-bottom: none;
    }
    
    .admin-user-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .admin-user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .admin-user-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .admin-btn {
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      border: none;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .ban-btn {
      background: var(--error);
      color: white;
    }
    
    .unban-btn {
      background: var(--success);
      color: var(--dark-bg);
    }
    
    /* Banned Message */
    .banned-message {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 3000;
      color: var(--error);
      font-size: 2rem;
      text-align: center;
      padding: 2rem;
      flex-direction: column;
    }
    
    .banned-message h2 {
      color: var(--error);
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    
    .banned-message button {
      margin-top: 2rem;
      padding: 1rem 2rem;
      background: var(--error);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.2rem;
      cursor: pointer;
      font-weight: 600;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 600px) {
      .upgrades-grid {
        grid-template-columns: 1fr;
      }
      
      .quantum-nav {
        position: static;
        justify-content: center;
        margin-bottom: 1rem;
      }
      
      .admin-user {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .admin-user-actions {
        width: 100%;
        justify-content: flex-end;
      }
    }
  </style>
  
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="container">
    <div class="quantum-nav">
      <!-- Google Sign-In Button -->
      <div id="g_id_onload"
           data-client_id="626223048098-078etpvps2clhd02vs3g5h22sa60537g.apps.googleusercontent.com"
           data-callback="handleQuantumSignIn"
           data-context="signin"
           data-ux_mode="popup"
           data-auto_prompt="false">
      </div>
      <div class="g_id_signin"
           data-type="standard"
           data-size="medium"
           data-theme="filled_blue"
           data-text="sign_in_with"
           data-shape="pill"
           data-logo_alignment="left">
      </div>
      
      <!-- User Profile -->
      <div class="quantum-profile" id="quantumProfile">
        <img class="profile-avatar" id="profileAvatar" src="" alt="Profile">
        <span class="profile-name" id="profileName"></span>
      </div>
      
      <button class="nav-btn" id="signOutBtn">Sign Out</button>
      <button class="nav-btn" id="adminBtn">Admin Panel</button>
    </div>
    
    <header>
      <h1>Quantum Tycoon</h1>
      <p>Harness quantum energy to build your empire</p>
    </header>
    
    <div class="stats">
      <div>
        <div class="quantum-display" id="quantumEnergy">0</div>
        <div class="qps-display" id="qps">0 QE/sec</div>
        <div class="entanglement-display" id="entanglement">Entanglement: 0</div>
      </div>
    </div>
    
    <div class="click-area">
      <button class="quantum-btn" id="quantumClicker">Harvest Energy (1 QE)</button>
      <div class="hint">(Click or press SPACE - no holding!)</div>
    </div>
    
    <h2>Quantum Upgrades</h2>
    <div class="upgrades-grid" id="quantumUpgrades"></div>
    
    <h2>Entanglement Upgrades</h2>
    <div class="upgrades-grid" id="entanglementUpgrades"></div>
  </div>

  <!-- Admin Panel -->
  <div class="admin-panel" id="adminPanel">
    <div class="admin-content">
      <button class="close-modal" id="closeAdminPanel">&times;</button>
      <h3 class="admin-title">Quantum Administration</h3>
      
      <div class="admin-user-list" id="adminUserList">
        <div class="loading-spinner"></div>
      </div>
      
      <div class="admin-actions">
        <button class="admin-btn ban-btn" id="refreshUsersBtn">Refresh Users</button>
      </div>
    </div>
  </div>

  <!-- Banned Message -->
  <div class="banned-message" id="bannedMessage" style="display: none;">
    <h2>Quantum Access Restricted</h2>
    <p>Your access to the quantum network has been suspended.</p>
    <button id="signOutAfterBan">Sign Out</button>
  </div>

  <script>
    // ======================
    // QUANTUM GAME STATE
    // ======================
    const ADMIN_EMAIL = "yhpatel@lcstudents.com";
    let playerName = "Quantum Traveler";
    let playerEmail = "";
    let playerAvatar = "";
    let playerId = "";
    let isAdmin = false;
    let isSignedIn = false;
    let entanglementCount = 0;
    
    // Game state
    let quantumEnergy = 0;
    let energyPerClick = 1;
    let energyPerSecond = 0;
    let highestVisibleUpgrade = 3;
    let spacePressed = false;
    let spaceCooldown = false;
    
    // Quantum upgrades
    const quantumUpgrades = [
      { id: 1, name: "Qubit Generator", baseCost: 10, owned: 0, effect: 0.5, desc: "Basic quantum fluctuation" },
      { id: 2, name: "Superposition Core", baseCost: 50, owned: 0, effect: 2, desc: "Exists in multiple states" },
      { id: 3, name: "Entanglement Link", baseCost: 100, owned: 0, effect: 3, desc: "Instant connection across space" },
      { id: 4, name: "Quantum Computer", baseCost: 200, owned: 0, effect: 5, desc: "Exponential calculations" },
      { id: 5, name: "Temporal Manipulator", baseCost: 500, owned: 0, effect: 8, desc: "Bend time to your will" },
      { id: 6, name: "Wormhole Stabilizer", baseCost: 1000, owned: 0, effect: 12, desc: "Bridge distant points" },
      { id: 7, name: "Dark Matter Collector", baseCost: 2000, owned: 0, effect: 18, desc: "Harness invisible mass" },
      { id: 8, name: "Singularity Engine", baseCost: 5000, owned: 0, effect: 25, desc: "Infinite density, infinite power" },
      { id: 9, name: "Multiverse Gateway", baseCost: 10000, owned: 0, effect: 35, desc: "Access parallel realities" },
      { id: 10, name: "Reality Forge", baseCost: 20000, owned: 0, effect: 50, desc: "Create your own universes" },
      { id: 11, name: "Omnipotent Node", baseCost: 50000, owned: 0, effect: 75, desc: "All-powerful quantum source" },
      { id: 12, name: "Quantum Godhood", baseCost: 100000, owned: 0, effect: 100, desc: "Transcend physical limits" }
    ];
    
    // Entanglement upgrades
    const entanglementUpgrades = [
      { id: 1, name: "+10% QE", cost: 1, purchased: false, effect: 1.1 },
      { id: 2, name: "+25% QE", cost: 2, purchased: false, effect: 1.25 },
      { id: 3, name: "+50% QE", cost: 3, purchased: false, effect: 1.5 },
      { id: 4, name: "Double Click", cost: 5, purchased: false, effect: 2.0, clickEffect: true },
      { id: 5, name: "+100% QE", cost: 7, purchased: false, effect: 2.0 },
      { id: 6, name: "Triple Click", cost: 10, purchased: false, effect: 3.0, clickEffect: true },
      { id: 7, name: "+200% QE", cost: 15, purchased: false, effect: 3.0 },
      { id: 8, name: "5x Click", cost: 20, purchased: false, effect: 5.0, clickEffect: true },
      { id: 9, name: "+300% QE", cost: 30, purchased: false, effect: 4.0 },
      { id: 10, name: "10x Click", cost: 40, purchased: false, effect: 10.0, clickEffect: true }
    ];
    
    // ======================
    // QUANTUM FUNCTIONS
    // ======================
    function quantumLoop() {
      quantumEnergy += energyPerSecond;
      updateQuantumDisplay();
      checkForNewUpgrades();
      renderQuantumUpgrades();
      renderEntanglementUpgrades();
      saveQuantumState();
    }
    
    function createQuantumParticle() {
      const particle = document.createElement('div');
      particle.className = 'quantum-particle';
      
      // Random shape (circle or square)
      if (Math.random() > 0.5) {
        particle.style.borderRadius = '50%';
      }
      
      // Random color (blue or purple)
      particle.style.backgroundColor = Math.random() > 0.5 ? 'var(--quantum-blue)' : 'var(--neon-purple)';
      
      // Random position
      const xPos = Math.random() * 100;
      particle.style.left = `${xPos}%`;
      
      // Random animation
      const duration = 2 + Math.random() * 2;
      particle.style.animationDuration = `${duration}s`;
      
      // Random size
      const size = 20 + Math.random() * 30;
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      
      document.body.appendChild(particle);
      
      // Remove after animation
      setTimeout(() => particle.remove(), duration * 1000);
    }
    
    function harvestQuantumEnergy() {
      quantumEnergy += energyPerClick;
      updateQuantumDisplay();
      checkForNewUpgrades();
      saveQuantumState();
      
      // Create visual effect
      createQuantumParticle();
      
      // Animation
      const energyDisplay = document.getElementById("quantumEnergy");
      energyDisplay.classList.add("quantum-pulse");
      setTimeout(() => energyDisplay.classList.remove("quantum-pulse"), 500);
    }
    
    function updateQuantumDisplay() {
      document.getElementById("quantumEnergy").textContent = Math.floor(quantumEnergy).toLocaleString();
      document.getElementById("qps").textContent = `${energyPerSecond.toFixed(1)} QE/sec`;
      document.getElementById("entanglement").textContent = `Entanglement: ${entanglementCount}`;
      updateClickerText();
    }
    
    function updateClickerText() {
      document.getElementById("quantumClicker").textContent = `Harvest Energy (${energyPerClick.toLocaleString()} QE)`;
    }
    
    function checkForNewUpgrades() {
      for (let i = 0; i < quantumUpgrades.length; i++) {
        const upgrade = quantumUpgrades[i];
        const cost = getUpgradeCost(upgrade);
        
        // Show next upgrade when player has 25% of current upgrade's cost
        if (i > highestVisibleUpgrade && quantumEnergy >= cost * 0.25) {
          highestVisibleUpgrade = i;
          renderQuantumUpgrades();
        }
      }
    }
    
    function renderQuantumUpgrades() {
      const upgradesContainer = document.getElementById("quantumUpgrades");
      upgradesContainer.innerHTML = "";
      
      const visibleUpgrades = quantumUpgrades.slice(0, highestVisibleUpgrade + 1);
      
      visibleUpgrades.forEach(upgrade => {
        const cost = getUpgradeCost(upgrade);
        const canAfford = quantumEnergy >= cost;
        
        const upgradeEl = document.createElement("div");
        upgradeEl.className = `quantum-upgrade ${canAfford ? "unlocked" : "locked"}`;
        upgradeEl.setAttribute('data-id', upgrade.id);
        
        const progress = Math.min(1, quantumEnergy / cost);
        
        upgradeEl.innerHTML = `
          <div class="upgrade-name">${upgrade.name}</div>
          <div class="upgrade-desc">${upgrade.desc}</div>
          <div>
            <span class="upgrade-cost">${cost.toLocaleString()} QE</span>
            <span class="upgrade-owned">Owned: ${upgrade.owned}</span>
          </div>
        `;
        
        upgradesContainer.appendChild(upgradeEl);
      });
    }
    
    function renderEntanglementUpgrades() {
      const upgradesContainer = document.getElementById("entanglementUpgrades");
      upgradesContainer.innerHTML = "";
      
      entanglementUpgrades.forEach(upgrade => {
        const canAfford = entanglementCount >= upgrade.cost && !upgrade.purchased;
        
        const upgradeEl = document.createElement("div");
        upgradeEl.className = `quantum-upgrade ${canAfford ? "unlocked" : "locked"}`;
        upgradeEl.setAttribute('data-id', upgrade.id);
        
        upgradeEl.innerHTML = `
          <div class="upgrade-name">${upgrade.name}</div>
          <div class="upgrade-desc">${upgrade.clickEffect ? `Multiplies click power by ${upgrade.effect}` : `Multiplies QPS by ${upgrade.effect}`}</div>
          <div>
            <span class="upgrade-cost" style="color: var(--gold)">${upgrade.cost} Entanglement</span>
            <span class="upgrade-owned">${upgrade.purchased ? 'Purchased' : ''}</span>
          </div>
        `;
        
        upgradesContainer.appendChild(upgradeEl);
      });
    }
    
    function buyQuantumUpgrade(id) {
      const upgrade = quantumUpgrades.find(u => u.id === id);
      const cost = getUpgradeCost(upgrade);
      
      if (quantumEnergy >= cost) {
        quantumEnergy -= cost;
        upgrade.owned++;
        energyPerSecond += upgrade.effect;
        updateQuantumDisplay();
        renderQuantumUpgrades();
        saveQuantumState();
        
        // Visual feedback
        const upgradeEl = document.querySelector(`.quantum-upgrade[data-id="${id}"]`);
        if (upgradeEl) {
          upgradeEl.classList.add('quantum-pulse');
          setTimeout(() => upgradeEl.classList.remove('quantum-pulse'), 500);
        }
      }
    }
    
    function buyEntanglementUpgrade(id) {
      const upgrade = entanglementUpgrades.find(u => u.id === id);
      
      if (!upgrade.purchased && entanglementCount >= upgrade.cost) {
        entanglementCount -= upgrade.cost;
        upgrade.purchased = true;
        
        if (upgrade.clickEffect) {
          energyPerClick *= upgrade.effect;
        } else {
          energyPerSecond *= upgrade.effect;
        }
        
        updateQuantumDisplay();
        renderEntanglementUpgrades();
        saveQuantumState();
      }
    }
    
    function getUpgradeCost(upgrade) {
      return Math.floor(upgrade.baseCost * Math.pow(1.5, upgrade.owned));
    }
    
    // ======================
    // QUANTUM AUTHENTICATION
    // ======================
    function handleQuantumSignIn(response) {
      try {
        const userData = parseJWT(response.credential);
        playerName = userData.name;
        playerEmail = userData.email;
        playerAvatar = userData.picture;
        playerId = userData.sub;
        isSignedIn = true;
        
        // Check if banned
        if (isUserBanned()) {
          showBannedMessage();
          return;
        }
        
        // Check if admin
        if (playerEmail === ADMIN_EMAIL) {
          isAdmin = true;
          document.getElementById('adminBtn').style.display = "block";
        }
        
        // Update UI
        document.querySelector('.g_id_signin').style.display = 'none';
        document.getElementById('signOutBtn').style.display = "block";
        document.getElementById('quantumProfile').style.display = "flex";
        document.getElementById('profileAvatar').src = playerAvatar;
        document.getElementById('profileName').textContent = playerName;
        
        // Save user info
        localStorage.setItem('quantumUser', JSON.stringify({
          name: playerName,
          email: playerEmail,
          avatar: playerAvatar,
          id: playerId
        }));
        
        // Load game
        loadQuantumState();
        
        // Start game loop
        setInterval(quantumLoop, 1000);
      } catch (error) {
        console.error("Quantum sign-in error:", error);
      }
    }
    
    function isUserBanned() {
      return localStorage.getItem(`banned_${playerId}`) === 'true';
    }
    
    function showBannedMessage() {
      document.getElementById("bannedMessage").style.display = "flex";
      document.querySelector(".container").style.display = "none";
    }
    
    function signOut() {
      google.accounts.id.disableAutoSelect();
      localStorage.removeItem('quantumUser');
      location.reload();
    }
    
    function parseJWT(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      return JSON.parse(atob(base64));
    }
    
    // ======================
    // QUANTUM ADMIN PANEL
    // ======================
    function loadAdminUsers() {
      const userList = document.getElementById("adminUserList");
      userList.innerHTML = '<div class="loading-spinner"></div>';
      
      // Get all users from localStorage
      const users = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('quantumSave_')) {
          const userData = JSON.parse(localStorage.getItem(key));
          users.push({
            id: userData.id,
            name: userData.name,
            energy: userData.quantumEnergy,
            entanglement: userData.entanglementCount
          });
        }
      }
      
      renderAdminUsers(users);
    }
    
    function renderAdminUsers(users) {
      const userList = document.getElementById("adminUserList");
      userList.innerHTML = "";
      
      if (users.length === 0) {
        userList.innerHTML = '<p>No quantum travelers found</p>';
        return;
      }
      
      users.forEach(user => {
        const isBanned = localStorage.getItem(`banned_${user.id}`) === 'true';
        
        const userEl = document.createElement('div');
        userEl.className = 'admin-user';
        
        userEl.innerHTML = `
          <div class="admin-user-info">
            <span>${user.name || "Quantum Traveler"}</span>
          </div>
          <div class="admin-user-actions">
            ${isBanned ? 
              `<button class="admin-btn unban-btn" data-id="${user.id}">Unban</button>` : 
              `<button class="admin-btn ban-btn" data-id="${user.id}">Ban</button>`
            }
          </div>
        `;
        
        userList.appendChild(userEl);
      });
      
      // Add event listeners
      document.querySelectorAll('.ban-btn').forEach(btn => {
        btn.addEventListener('click', () => banUser(btn.dataset.id));
      });
      
      document.querySelectorAll('.unban-btn').forEach(btn => {
        btn.addEventListener('click', () => unbanUser(btn.dataset.id));
      });
    }
    
    function banUser(userId) {
      localStorage.setItem(`banned_${userId}`, 'true');
      loadAdminUsers();
      
      // If banning current user, show banned message
      if (userId === playerId) {
        showBannedMessage();
      }
    }
    
    function unbanUser(userId) {
      localStorage.removeItem(`banned_${userId}`);
      loadAdminUsers();
    }
    
    // ======================
    // QUANTUM SAVE SYSTEM
    // ======================
    function saveQuantumState() {
      const gameData = {
        quantumEnergy,
        energyPerClick,
        energyPerSecond,
        highestVisibleUpgrade,
        entanglementCount,
        quantumUpgrades: quantumUpgrades.map(u => ({ id: u.id, owned: u.owned })),
        entanglementUpgrades: entanglementUpgrades.map(u => ({ id: u.id, purchased: u.purchased })),
        name: playerName,
        id: playerId
      };
      
      localStorage.setItem(`quantumSave_${playerId}`, JSON.stringify(gameData));
    }
    
    function loadQuantumState() {
      const savedData = localStorage.getItem(`quantumSave_${playerId}`);
      if (savedData) {
        const gameData = JSON.parse(savedData);
        
        quantumEnergy = gameData.quantumEnergy || 0;
        energyPerClick = gameData.energyPerClick || 1;
        energyPerSecond = gameData.energyPerSecond || 0;
        entanglementCount = gameData.entanglementCount || 0;
        highestVisibleUpgrade = gameData.highestVisibleUpgrade || 3;
        
        // Load upgrades
        if (gameData.quantumUpgrades) {
          gameData.quantumUpgrades.forEach(savedUpgrade => {
            const upgrade = quantumUpgrades.find(u => u.id === savedUpgrade.id);
            if (upgrade) upgrade.owned = savedUpgrade.owned || 0;
          });
        }
        
        if (gameData.entanglementUpgrades) {
          gameData.entanglementUpgrades.forEach(savedUpgrade => {
            const upgrade = entanglementUpgrades.find(u => u.id === savedUpgrade.id);
            if (upgrade) {
              upgrade.purchased = savedUpgrade.purchased || false;
              if (upgrade.purchased) {
                if (upgrade.clickEffect) {
                  energyPerClick *= upgrade.effect;
                } else {
                  energyPerSecond *= upgrade.effect;
                }
              }
            }
          });
        }
        
        updateQuantumDisplay();
        renderQuantumUpgrades();
        renderEntanglementUpgrades();
      } else {
        // New player - give 3 entanglement
        entanglementCount = 3;
        saveQuantumState();
      }
    }
    
    // ======================
    // QUANTUM EVENT HANDLERS
    // ======================
    document.addEventListener('DOMContentLoaded', () => {
      // Check for saved user
      const savedUser = localStorage.getItem('quantumUser');
      if (savedUser) {
        const user = JSON.parse(savedUser);
        playerName = user.name;
        playerEmail = user.email;
        playerAvatar = user.avatar;
        playerId = user.id;
        isSignedIn = true;
        
        if (playerEmail === ADMIN_EMAIL) {
          isAdmin = true;
          document.getElementById('adminBtn').style.display = "block";
        }
        
        document.querySelector('.g_id_signin').style.display = 'none';
        document.getElementById('signOutBtn').style.display = "block";
        document.getElementById('quantumProfile').style.display = "flex";
        document.getElementById('profileAvatar').src = playerAvatar;
        document.getElementById('profileName').textContent = playerName;
        
        loadQuantumState();
        setInterval(quantumLoop, 1000);
      }
      
      // Clicker button
      document.getElementById('quantumClicker').addEventListener('click', harvestQuantumEnergy);
      
      // Spacebar handling
      document.addEventListener('keydown', (e) => {
        if (e.code === "Space" && !spacePressed && !spaceCooldown) {
          e.preventDefault();
          spacePressed = true;
          harvestQuantumEnergy();
          
          // Cooldown
          spaceCooldown = true;
          setTimeout(() => spaceCooldown = false, 300);
        }
      });
      
      document.addEventListener('keyup', (e) => {
        if (e.code === "Space") {
          spacePressed = false;
        }
      });
      
      // Upgrade click handlers
      document.addEventListener('click', function(e) {
        if (e.target.closest('.quantum-upgrade.unlocked')) {
          const upgradeId = parseInt(e.target.closest('.quantum-upgrade').getAttribute('data-id'));
          
          if (e.target.closest('#quantumUpgrades')) {
            buyQuantumUpgrade(upgradeId);
          } else if (e.target.closest('#entanglementUpgrades')) {
            buyEntanglementUpgrade(upgradeId);
          }
        }
      });
      
      // Admin panel
      document.getElementById('adminBtn').addEventListener('click', () => {
        document.getElementById("adminPanel").style.display = "flex";
        loadAdminUsers();
      });
      
      document.getElementById('closeAdminPanel').addEventListener('click', () => {
        document.getElementById("adminPanel").style.display = "none";
      });
      
      document.getElementById('refreshUsersBtn').addEventListener('click', loadAdminUsers);
      
      // Banned message
      document.getElementById('signOutAfterBan').addEventListener('click', signOut);
    });
  </script>
</body>
</html>
