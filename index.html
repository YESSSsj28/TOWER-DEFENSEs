<!DOCTYPE html>
<html>
<head>
    <title>Fixed Real-Time Chat</title>
    <style>
        /* Keep the same CSS styles from previous version */
        body { font-family: Arial; max-width: 600px; margin: 0 auto; padding: 20px; }
        #chat { height: 400px; border: 1px solid #ddd; padding: 10px; overflow-y: scroll; }
        #message { width: 70%; padding: 10px; }
        button { padding: 10px 15px; }
    </style>
</head>
<body>
    <h1>Fixed Chat</h1>
    <div id="chat"></div>
    <input type="text" id="message" placeholder="Type your message">
    <button onclick="sendMessage()">Send</button>

    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <script>
        // Pusher Setup (YOUR CREDENTIALS)
        const pusher = new Pusher('93f04e4635b812b156f1', {
            cluster: 'us2',
            encrypted: true
        });

        // Channel name MUST match exactly
        const channel = pusher.subscribe('friends-chat-room');

        // Event names MUST match exactly
        channel.bind('client-new-message', function(data) {
            console.log('Received:', data); // Debug log
            const chat = document.getElementById('chat');
            chat.innerHTML += `<p><strong>${data.name}:</strong> ${data.message}</p>`;
            chat.scrollTop = chat.scrollHeight;
        });

        // Send message
        function sendMessage() {
            const message = document.getElementById('message').value;
            if (!message) return;
            
            const name = prompt("Your name:") || "Anonymous";
            console.log('Sending:', {name, message}); // Debug log

            // Critical: Event name must start with "client-"
            channel.trigger('client-new-message', {
                name: name,
                message: message
            });

            document.getElementById('message').value = '';
        }

        // Open console to see debug logs (Ctrl+Shift+J)
        console.log('Pusher connection status:', pusher.connection.state);
    </script>
</body>
</html>
