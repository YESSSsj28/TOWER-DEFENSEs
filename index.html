<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Business Empire Clicker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Cyberpunk Theme Variables */
    :root {
      --neon-pink: #ff2a6d;
      --neon-blue: #05d9e8;
      --neon-purple: #d300c5;
      --neon-green: #00ff9d;
      --matrix-green: #00ff41;
      --dark-bg: #0d0221;
      --darker-bg: #070113;
      --card-bg: rgba(16, 0, 43, 0.7);
      --card-border: rgba(255, 42, 109, 0.3);
      --text: #d1f7ff;
      --text-secondary: #8b8b8b;
      --warning: #f59e0b;
      --disabled: #4b5563;
      --gold: #ffd700;
      --silver: #c0c0c0;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Roboto Mono', monospace;
      background: var(--dark-bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      line-height: 1.6;
      touch-action: manipulation;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(255, 42, 109, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(5, 217, 232, 0.1) 0%, transparent 20%),
        linear-gradient(to bottom, var(--dark-bg), var(--darker-bg));
    }

// +++ NEW CODE +++
// ======================
// JSONBIN CONFIGURATION (INSECURE - See note above)
// ======================
const JSONBIN_API_KEY = "$2a$10$Yz/2wjACdUUylbxkfwTuwewZPpHoQDQ7t18lUPSFNjQf3Oh3fWY2e"; // WARNING: Exposing keys client-side is insecure!
const JSONBIN_BIN_ID = "67ed46428960c979a57cfe91";
const JSONBIN_API_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

// ======================
// API HELPER FUNCTIONS
// ======================
async function fetchLeaderboardData() {
    try {
        const response = await fetch(`${JSONBIN_API_URL}/latest`, {
            method: 'GET',
            headers: {
                'X-Master-Key': JSONBIN_API_KEY
            }
        });
        if (!response.ok) {
            // If the bin is empty or doesn't exist, JSONBin might return 404
            if (response.status === 404) {
                console.log("JSONBin: Bin not found or empty. Returning empty array.");
                return []; // Return empty array for a new bin
            }
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        // The actual data is usually nested under 'record'
        return data.record || [];
    } catch (error) {
        console.error("Error fetching leaderboard data:", error);
        // Fallback to local cache if API fails
        loadFromCache();
        return leaderboardData; // Return locally cached data on error
    }
}

async function updateLeaderboardData(newData) {
    try {
        const response = await fetch(JSONBIN_API_URL, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': JSONBIN_API_KEY,
                'X-Bin-Versioning': 'false' // Disable versioning to overwrite directly
            },
            body: JSON.stringify(newData) // Send the entire array
        });
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const result = await response.json();
        console.log("Leaderboard updated successfully:", result);
        return true;
    } catch (error) {
        console.error("Error updating leaderboard data:", error);
        return false;
    }
}
// +++ END OF NEW CODE +++








    
    /* Animated starfield background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(1px 1px at 10% 20%, white 0.5px, transparent 1px),
        radial-gradient(1px 1px at 90% 80%, white 0.5px, transparent 1px),
        radial-gradient(1px 1px at 30% 50%, white 0.5px, transparent 1px),
        radial-gradient(1px 1px at 70% 10%, white 0.5px, transparent 1px);
      background-size: 200px 200px;
      z-index: -1;
      animation: starsMove 100s linear infinite;
    }
    
    @keyframes starsMove {
      from { transform: translateY(0); }
      to { transform: translateY(-200px); }
    }
    
    .container {
      width: 100%;
      max-width: 800px;
      position: relative;
      padding-bottom: 2rem;
    }
    
    header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-top: 1rem;
    }
    
    h1 {
      font-size: clamp(1.8rem, 5vw, 2.5rem);
      margin-bottom: 0.5rem;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
      letter-spacing: -0.05em;
      text-shadow: 0 0 10px rgba(255, 42, 109, 0.5);
      position: relative;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 50%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
      box-shadow: 0 0 10px var(--neon-blue);
    }
    
    h2 {
      font-size: 1.25rem;
      margin: 1.5rem 0 1rem;
      color: var(--neon-green);
      font-weight: 600;
      text-shadow: 0 0 5px var(--neon-green);
      letter-spacing: 1px;
    }
    
    .stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card-bg);
      padding: 1.25rem;
      border-radius: 16px;
      margin-bottom: 1.5rem;
      box-shadow: 0 0 15px rgba(255, 42, 109, 0.3);
      width: 100%;
      border: 1px solid var(--card-border);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
    }
    
    .stats::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
      box-shadow: 0 0 10px var(--neon-pink);
    }
    
    .coins-display {
      font-size: clamp(1.5rem, 5vw, 2rem);
      font-weight: bold;
      color: var(--neon-green);
      letter-spacing: -0.05em;
      text-shadow: 0 0 10px var(--neon-green);
      font-family: 'Roboto Mono', monospace;
    }
    
    .cps-display {
      color: var(--text-secondary);
      font-size: clamp(0.8rem, 3vw, 1rem);
      margin-top: 0.25rem;
      font-family: 'Roboto Mono', monospace;
    }
    
    .golden-coins-display {
      color: var(--gold);
      font-size: clamp(0.8rem, 3vw, 1rem);
      margin-top: 0.25rem;
      font-weight: 600;
      text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
      font-family: 'Roboto Mono', monospace;
    }
    
    .click-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
      width: 100%;
      position: relative;
    }
    
    .click-btn {
      background: linear-gradient(145deg, var(--neon-pink), var(--neon-purple));
      color: white;
      border: none;
      padding: 1.25rem;
      font-size: clamp(1rem, 4vw, 1.2rem);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      max-width: 300px;
      box-shadow: 0 0 20px rgba(255, 42, 109, 0.5);
      font-weight: 600;
      border: 2px solid var(--neon-blue);
      position: relative;
      overflow: hidden;
      z-index: 1;
      font-family: 'Roboto Mono', monospace;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }
    
    .click-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, 
        rgba(255,255,255,0.1) 0%, 
        rgba(255,255,255,0.05) 50%, 
        rgba(255,255,255,0.1) 100%);
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .click-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(255, 42, 109, 0.7);
    }
    
    .click-btn:hover::before {
      opacity: 1;
    }
    
    .click-btn:active {
      transform: translateY(0);
      box-shadow: 0 0 15px rgba(255, 42, 109, 0.3);
    }
    
    .hint {
      color: var(--text-secondary);
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      text-align: center;
      opacity: 0.8;
      font-family: 'Roboto Mono', monospace;
    }
    
    .upgrades-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
      width: 100%;
    }
    
    .upgrade {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.2s ease;
      border-left: 4px solid var(--neon-pink);
      font-size: clamp(0.8rem, 3vw, 1rem);
      border: 1px solid var(--card-border);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
    }
    
    .upgrade::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, 
        rgba(0, 255, 157, 0.05) 0%, 
        rgba(0, 255, 157, 0.02) 50%, 
        rgba(0, 255, 157, 0.05) 100%);
      z-index: 0;
    }
    
    .upgrade.unlocked {
      cursor: pointer;
    }
    
    .upgrade.unlocked:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 20px rgba(255, 42, 109, 0.3);
      background: rgba(16, 0, 43, 0.9);
      border-color: var(--neon-blue);
    }
    
    .upgrade.locked {
      opacity: 0.6;
      border-left-color: var(--disabled);
    }
    
    .upgrade-name {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--neon-green);
      font-size: clamp(0.9rem, 3vw, 1rem);
      position: relative;
      z-index: 1;
      text-shadow: 0 0 5px var(--neon-green);
    }
    
    .upgrade-desc {
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      margin-bottom: 0.75rem;
      color: var(--text-secondary);
      flex-grow: 1;
      position: relative;
      z-index: 1;
    }
    
    .upgrade-cost {
      color: var(--text-secondary);
      font-weight: 600;
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 1;
    }
    
    .upgrade-owned {
      color: var(--text);
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      align-self: flex-end;
      position: relative;
      z-index: 1;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .pulse {
      animation: pulse 0.3s ease;
    }
    
    .progress-bar {
      height: 6px;
      background: var(--disabled);
      border-radius: 3px;
      margin-top: 0.75rem;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }
    
    .progress {
      height: 100%;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
      width: 0%;
      transition: width 0.3s ease;
      box-shadow: 0 0 5px var(--neon-pink);
    }
    
    /* Coin animation */
    .falling-coin {
      position: absolute;
      width: 40px;
      height: 40px;
      pointer-events: none;
      z-index: 100;
      animation: coin-fall linear forwards;
      filter: drop-shadow(0 0 5px var(--gold));
    }
    
    @keyframes coin-fall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(calc(100vh + 100px)) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Top Buttons */
    .top-buttons {
      position: absolute;
      top: 0.5rem;
      right: 0;
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
      max-width: 100%;
    }
    
    .top-btn {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-secondary);
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 24px;
      cursor: pointer;
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      transition: all 0.2s ease;
      margin-bottom: 0.5rem;
      font-weight: 500;
      border: 1px solid var(--card-border);
      white-space: nowrap;
      font-family: 'Roboto Mono', monospace;
    }
    
    .top-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      color: var(--text);
      border-color: var(--neon-blue);
    }
    
    #signOutBtn {
      display: none;
      background: var(--neon-pink);
      color: white;
      border-color: var(--neon-purple);
    }
    
    #adminBtn {
      display: none;
      background: var(--neon-green);
      color: var(--dark-bg);
      border-color: var(--matrix-green);
    }
    
    /* Google Sign-In Button Customization */
    #g_id_onload {
      display: none;
    }
    
    .g_id_signin {
      border: none !important;
      background: #4285F4 !important;
      color: white !important;
      border-radius: 24px !important;
      height: 38px !important;
      padding: 0 16px !important;
      margin-bottom: 0.5rem;
      transition: all 0.2s ease !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
    }
    
    .g_id_signin:hover {
      background: #3367D6 !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    }
    
    /* User Profile Display */
    .user-profile {
      display: none;
      align-items: center;
      gap: 8px;
      margin-bottom: 0.5rem;
      background: rgba(255, 255, 255, 0.05);
      padding: 0.5rem 0.75rem;
      border-radius: 24px;
      border: 1px solid var(--card-border);
    }
    
    .user-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .username-container {
      display: flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
    }
    
    .username-edit {
      width: 14px;
      height: 14px;
      opacity: 0.6;
      transition: all 0.2s;
      fill: var(--text-secondary);
    }
    
    .username-container:hover .username-edit {
      opacity: 1;
      fill: var(--text);
    }
    
    .user-name {
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      color: var(--text);
      font-weight: 500;
    }
    
    /* Modals */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
      overflow-y: auto;
      padding: 1rem;
    }
    
    .modal-content {
      background: var(--card-bg);
      padding: 1.75rem;
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--card-border);
      animation: modalSlideUp 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    @keyframes modalSlideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .close-modal {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      transition: all 0.2s;
    }
    
    .close-modal:hover {
      color: var(--text);
      transform: rotate(90deg);
    }
    
    .modal-title {
      font-size: clamp(1.2rem, 5vw, 1.5rem);
      color: var(--neon-green);
      margin-bottom: 1.5rem;
      font-weight: 600;
      text-shadow: 0 0 5px var(--neon-green);
    }
    
    /* Click Upgrades Modal */
    .click-upgrades-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 1rem;
    }
    
    .click-upgrade {
      background: rgba(0, 0, 0, 0.15);
      border-radius: 12px;
      padding: 1rem;
      border-left: 4px solid var(--neon-pink);
      transition: all 0.2s ease;
      font-size: clamp(0.8rem, 3vw, 1rem);
      border: 1px solid var(--card-border);
    }
    
    .click-upgrade.unlocked {
      cursor: pointer;
    }
    
    .click-upgrade.unlocked:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      background: var(--card-bg);
    }
    
    .click-upgrade.locked {
      opacity: 0.6;
      border-left-color: var(--disabled);
    }
    
    .click-upgrade-name {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--neon-green);
      font-size: clamp(0.9rem, 3vw, 1rem);
    }
    
    .click-upgrade-desc {
      font-size: clamp(0.7rem, 3vw, 0.8rem);
      margin-bottom: 0.75rem;
      color: var(--text-secondary);
    }
    
    .click-upgrade-cost {
      color: var(--text-secondary);
      font-weight: 600;
      font-size: clamp(0.7rem, 3vw, 0.9rem);
    }
    
    .click-upgrade-owned {
      color: var(--text);
      font-size: clamp(0.7rem, 3vw, 0.8rem);
      font-style: italic;
      margin-top: 0.5rem;
    }
    
    /* Code Modal */
    .code-input {
      width: 100%;
      padding: 1rem;
      margin: 1.5rem 0;
      background: var(--darker-bg);
      border: 1px solid var(--neon-pink);
      border-radius: 12px;
      color: var(--text);
      font-size: 1rem;
      transition: all 0.2s;
      font-family: 'Roboto Mono', monospace;
    }
    
    .code-input:focus {
      outline: none;
      border-color: var(--neon-green);
      box-shadow: 0 0 0 2px rgba(0, 255, 157, 0.2);
    }
    
    .submit-btn {
      background: var(--neon-pink);
      color: white;
      border: none;
      padding: 1rem;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
      width: 100%;
      font-weight: 600;
      margin-top: 0.5rem;
      font-family: 'Roboto Mono', monospace;
    }
    
    .submit-btn:hover {
      background: var(--neon-purple);
    }
    
    .code-message {
      margin-top: 1.5rem;
      color: var(--neon-green);
      font-weight: 600;
      text-align: center;
      font-size: clamp(0.8rem, 3vw, 1rem);
      min-height: 1.5rem;
    }
    
    /* Leaderboard styles */
    .leaderboard-container {
      margin-top: 1rem;
      min-height: 300px;
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--card-border);
    }
    
    .leaderboard-entry {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--card-border);
      align-items: center;
      transition: all 0.3s ease;
      font-size: clamp(0.8rem, 3vw, 1rem);
      background: var(--card-bg);
    }
    
    .leaderboard-entry:hover {
      background: rgba(16, 0, 43, 0.9);
    }
    
    .leaderboard-rank {
      width: 24px;
      text-align: center;
      font-weight: bold;
      color: var(--text-secondary);
      flex-shrink: 0;
    }
    
    .leaderboard-user {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-grow: 1;
      margin: 0 0.75rem;
      overflow: hidden;
    }
    
    .leaderboard-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
    }
    
    .leaderboard-score {
      font-weight: bold;
      color: var(--neon-green);
      min-width: 100px;
      text-align: right;
      flex-shrink: 0;
    }
    
    .leaderboard-rebirths {
      color: var(--neon-blue);
      font-weight: bold;
      min-width: 60px;
      text-align: right;
      flex-shrink: 0;
    }
    
    /* Podium positions */
    .leaderboard-entry:nth-child(1) {
      background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), transparent);
      border-left: 4px solid var(--gold);
    }
    
    .leaderboard-entry:nth-child(2) {
      background: linear-gradient(90deg, rgba(192, 192, 192, 0.1), transparent);
      border-left: 4px solid var(--silver);
    }
    
    .leaderboard-entry:nth-child(3) {
      background: linear-gradient(90deg, rgba(205, 127, 50, 0.1), transparent);
      border-left: 4px solid #cd7f32;
    }
    
    /* Loading spinner */
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 3px solid var(--neon-green);
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }
    
    /* Tabs */
    .leaderboard-tabs {
      display: flex;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--card-border);
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .tab-btn {
      background: none;
      border: none;
      padding: 0.5rem 1rem;
      color: var(--text-secondary);
      cursor: pointer;
      position: relative;
      font-size: clamp(0.7rem, 3vw, 0.9rem);
      white-space: nowrap;
      font-weight: 500;
      border-radius: 6px;
      transition: all 0.2s;
    }
    
    .tab-btn.active {
      color: var(--neon-green);
      background: rgba(0, 255, 157, 0.1);
    }
    
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--neon-green);
    }
    
    /* Countdown timer */
    .leaderboard-countdown {
      text-align: center;
      margin-top: 1.5rem;
      color: var(--text-secondary);
      font-size: clamp(0.8rem, 3vw, 1rem);
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Admin Panel Styles */
    .admin-panel {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(8px);
      z-index: 4000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }
    
    .admin-content {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 16px;
      width: 90%;
      max-width: 800px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--card-border);
    }
    
    .admin-tabs {
      display: flex;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid var(--card-border);
      gap: 0.5rem;
    }
    
    .admin-tab {
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      font-weight: 500;
      color: var(--text-secondary);
      border-radius: 6px 6px 0 0;
    }
    
    .admin-tab.active {
      border-bottom: 2px solid var(--neon-green);
      color: var(--neon-green);
      background: rgba(0, 255, 157, 0.1);
    }
    
    #refreshBtn {
      background: var(--warning);
      color: white;
      border: none;
      cursor: pointer;
      margin-left: auto;
      border-radius: 6px;
      padding: 0.75rem 1.25rem;
      transition: all 0.2s;
    }
    
    #refreshBtn:hover {
      background: #e67e22;
    }
    
    .admin-tab-content {
      display: none;
    }
    
    .admin-tab-content.active {
      display: block;
    }
    
    .admin-search {
      width: 100%;
      padding: 0.8rem 1rem;
      margin-bottom: 1.5rem;
      background: var(--darker-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      color: var(--text);
      font-size: 1rem;
    }
    
    .admin-user-list {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 1.5rem;
      border: 1px solid var(--card-border);
      border-radius: 12px;
      background: var(--darker-bg);
    }
    
    .admin-user {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--card-border);
    }
    
    .admin-user:last-child {
      border-bottom: none;
    }
    
    .admin-user-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .admin-user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .admin-user-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .admin-action-btn {
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      border: none;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .ban-btn {
      background: var(--neon-pink);
      color: white;
    }
    
    .unban-btn {
      background: var(--neon-green);
      color: var(--dark-bg);
    }
    
    .edit-btn {
      background: var(--neon-blue);
      color: var(--dark-bg);
    }
    
    .admin-message-input {
      width: 100%;
      padding: 1rem;
      margin-bottom: 1.5rem;
      background: var(--darker-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      color: var(--text);
      font-size: 1rem;
      min-height: 120px;
      resize: vertical;
    }
    
    .admin-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding: 0.75rem;
      background: var(--darker-bg);
      border-radius: 12px;
      border: 1px solid var(--card-border);
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--disabled);
      transition: .4s;
      border-radius: 24px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: var(--neon-green);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }
    
    .admin-status {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      text-align: center;
      font-weight: 500;
    }
    
    .success {
      background: rgba(0, 255, 157, 0.2);
      color: var(--neon-green);
      border: 1px solid rgba(0, 255, 157, 0.3);
    }
    
    .error {
      background: rgba(255, 42, 109, 0.2);
      color: var(--neon-pink);
      border: 1px solid rgba(255, 42, 109, 0.3);
    }

    /* Broadcast Message Style */
    .broadcast-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.9);
      color: var(--neon-pink);
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      z-index: 5000;
      max-width: 90%;
      box-shadow: 0 0 20px rgba(255, 42, 109, 0.4);
      animation: fadeIn 0.3s ease;
      border: 2px solid var(--neon-pink);
      backdrop-filter: blur(4px);
    }

    /* Banned User Style */
    .banned-message {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: var(--neon-pink);
      font-size: 2rem;
      text-align: center;
      padding: 2rem;
      flex-direction: column;
      backdrop-filter: blur(8px);
    }

    .banned-message h2 {
      color: var(--neon-pink);
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .banned-message p {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      color: var(--text-secondary);
    }

    .banned-message button {
      margin-top: 2rem;
      padding: 1rem 2rem;
      background: var(--neon-pink);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.2rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .banned-message button:hover {
      background: var(--neon-purple);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(211, 0, 197, 0.3);
    }

    /* Button loading state */
    .btn-loading {
      position: relative;
      pointer-events: none;
      opacity: 0.8;
    }
    
    .btn-loading::after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      margin: auto;
      border: 3px solid transparent;
      border-top-color: #ffffff;
      border-radius: 50%;
      animation: button-loading-spinner 1s ease infinite;
    }
    
    @keyframes button-loading-spinner {
      from { transform: rotate(0turn); }
      to { transform: rotate(1turn); }
    }

    /* Purchase effect */
    @keyframes purchaseEffect {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .purchase-effect {
      animation: purchaseEffect 0.3s ease;
    }

    /* Tutorial Modal */
    .tutorial-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }
    
    .tutorial-content {
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      position: relative;
      border: 1px solid var(--card-border);
    }
    
    .tutorial-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
    }
    
    .tutorial-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .skip-tutorial {
      background: var(--neon-pink);
      color: white;
      border: none;
    }
    
    .next-tutorial {
      background: var(--neon-green);
      color: var(--dark-bg);
      border: none;
    }

    /* Patch Notes Modal */
    .patch-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2000;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      animation: fadeIn 0.4s cubic-bezier(0.22, 1, 0.36, 1);
    }
    
    .patch-content {
      background: linear-gradient(135deg, rgba(13, 2, 33, 0.95) 0%, rgba(7, 1, 19, 0.95) 100%);
      border-radius: 16px;
      width: 90%;
      max-width: 700px;
      padding: 2rem;
      position: relative;
      box-shadow: 0 0 30px var(--neon-pink), 
                  0 0 60px var(--neon-blue);
      border: 1px solid var(--neon-purple);
      color: var(--text);
      font-family: 'Roboto Mono', monospace;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .patch-title {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      text-align: center;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 10px rgba(255, 42, 109, 0.5);
      letter-spacing: 2px;
    }
    
    .patch-subtitle {
      font-size: 1.2rem;
      color: var(--neon-green);
      margin: 1.5rem 0 0.5rem;
      border-bottom: 1px solid var(--neon-purple);
      padding-bottom: 0.5rem;
    }
    
    .patch-features {
      list-style-type: none;
      padding-left: 1rem;
    }
    
    .patch-features li {
      position: relative;
      padding-left: 1.5rem;
      margin-bottom: 0.75rem;
      line-height: 1.5;
    }
    
    .patch-features li:before {
      content: ">";
      position: absolute;
      left: 0;
      color: var(--matrix-green);
      font-weight: bold;
    }
    
    .patch-note {
      color: var(--neon-green);
      font-weight: bold;
    }
    
    .patch-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: var(--neon-pink);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .patch-close:hover {
      transform: rotate(90deg);
      color: var(--neon-blue);
    }

    /* Chat specific styles */
    .global-chat {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid var(--card-border);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      z-index: 100;
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    .global-chat:hover {
      box-shadow: 0 0 20px var(--neon-blue);
    }

    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--card-border);
    }

    .chat-title {
      color: var(--neon-green);
      font-weight: bold;
    }

    .chat-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.2rem;
    }

    .chat-messages {
      max-height: 200px;
      min-height: 100px;
      overflow-y: auto;
      margin-bottom: 1rem;
      background: var(--darker-bg);
      border-radius: 8px;
      padding: 0.5rem;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.9rem;
    }

    .chat-message {
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      background: rgba(255, 42, 109, 0.1);
      border-radius: 8px;
      font-size: 0.9rem;
      border-left: 2px solid var(--neon-pink);
    }

    .chat-message.system {
      background: rgba(0, 0, 0, 0.2);
      border-left: 2px solid var(--neon-blue);
    }

    .chat-message .username {
      font-weight: bold;
      color: var(--neon-green);
    }

    .chat-message .timestamp {
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-left: 0.5rem;
    }

    .chat-message .text {
      margin-top: 0.25rem;
      word-break: break-word;
    }

    .chat-input-container {
      display: flex;
      gap: 0.5rem;
    }

    .chat-input {
      flex-grow: 1;
      padding: 0.75rem;
      background: var(--darker-bg);
      border: 1px solid var(--card-border);
      border-radius: 8px;
      color: var(--text);
      font-family: 'Roboto Mono', monospace;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--neon-green);
      box-shadow: 0 0 0 2px rgba(0, 255, 157, 0.2);
    }

    .chat-send-btn {
      background: var(--neon-pink);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .chat-send-btn:hover {
      background: var(--neon-purple);
    }

    /* Chat toggle button */
    .chat-toggle-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: var(--neon-pink);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      z-index: 99;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
      box-shadow: 0 0 15px rgba(255, 42, 109, 0.5);
      transition: all 0.3s ease;
    }

    .chat-toggle-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px var(--neon-pink);
    }

    /* Achievements */
    .achievements-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .achievement {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid var(--card-border);
      position: relative;
      overflow: hidden;
    }

    .achievement.unlocked {
      border-left: 4px solid var(--gold);
    }

    .achievement.locked {
      border-left: 4px solid var(--disabled);
      opacity: 0.7;
    }

    .achievement-name {
      font-weight: 600;
      color: var(--neon-green);
      margin-bottom: 0.5rem;
    }

    .achievement-desc {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .achievement-reward {
      font-size: 0.8rem;
      color: var(--gold);
      font-weight: 600;
    }

    .achievement-progress {
      height: 4px;
      background: var(--disabled);
      border-radius: 2px;
      margin-top: 0.5rem;
      overflow: hidden;
    }

    .achievement-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-purple));
      width: 0%;
      transition: width 0.3s ease;
    }

    /* AFK Earnings */
    .afk-earnings {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--card-border);
    }

    .afk-title {
      color: var(--neon-green);
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .afk-amount {
      color: var(--gold);
      font-weight: bold;
    }

    /* Responsive adjustments */
    @media (max-width: 600px) {
      .upgrades-container {
        grid-template-columns: 1fr;
      }
      
      .click-upgrades-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-user {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .admin-user-actions {
        width: 100%;
        justify-content: flex-end;
      }

      .global-chat {
        width: calc(100% - 40px);
        right: 20px;
        left: 20px;
      }

      .chat-toggle-btn {
        bottom: 80px;
      }

      .achievements-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
  
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="container">
    <div class="top-buttons">
      <!-- Google Sign-In Button -->
      <div id="g_id_onload"
           data-client_id="626223048098-078etpvps2clhd02vs3g5h22sa60537g.apps.googleusercontent.com"
           data-callback="handleGoogleSignIn"
           data-context="signin"
           data-ux_mode="popup"
           data-auto_prompt="false">
      </div>
      <div class="g_id_signin"
           data-type="standard"
           data-size="medium"
           data-theme="filled_blue"
           data-text="sign_in_with"
           data-shape="pill"
           data-logo_alignment="left">
      </div>
      
      <!-- User Profile (shown after sign-in) -->
      <div class="user-profile" id="userProfile">
        <img class="user-avatar" id="userAvatar" src="" alt="Profile">
        <div class="username-container" id="usernameContainer">
          <span class="user-name" id="userName"></span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="username-edit">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
          </svg>
        </div>
      </div>
      
      <button class="top-btn" id="upgradeClicksBtn">Upgrade Clicks</button>
      <button class="top-btn" id="codeBtn">Enter Code</button>
      <button class="top-btn" id="leaderboardBtn">Leaderboard</button>
      <button class="top-btn" id="signOutBtn">Sign Out</button>
      <button class="top-btn" id="adminBtn">Admin Panel</button>
    </div>
    
    <header>
      <h1>Business Empire Clicker</h1>
      <p>Build your economic dynasty one click at a time</p>
    </header>
    
    <div class="stats">
      <div>
        <div class="coins-display" id="coins">0</div>
        <div class="cps-display" id="cps">0 coins/sec</div>
        <div class="golden-coins-display" id="goldenCoins">Golden Coins: 0</div>
      </div>
    </div>
    
    <div class="click-area">
      <button class="click-btn" id="clicker">Earn Coins (1 per click)</button>
      <div class="hint">(Click or press SPACE - no holding!)</div>
    </div>
    
    <h2>Business Upgrades</h2>
    <div class="upgrades-container" id="upgrades"></div>
    
    <h2>Golden Coin Upgrades</h2>
    <div class="upgrades-container" id="goldenUpgrades"></div>

    <h2>Achievements</h2>
    <div class="achievements-container" id="achievements"></div>

    <!-- AFK Earnings Display -->
    <div class="afk-earnings" id="afkEarnings" style="display: none;">
      <div class="afk-title">AFK Earnings</div>
      <div>While you were away, you earned <span class="afk-amount" id="afkAmount">0</span> coins!</div>
    </div>
  </div>

  <!-- Global Chat -->
  <button class="chat-toggle-btn" id="chatToggleBtn">ðŸ’¬</button>
  <div class="global-chat" id="globalChat">
    <div class="chat-header">
      <div class="chat-title">Global Chat</div>
      <button class="chat-toggle" id="closeChatBtn">Ã—</button>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chatInput" placeholder="Type message..." maxlength="100">
      <button class="chat-send-btn" id="sendChatBtn">Send</button>
    </div>
  </div>

  <!-- Click Upgrades Modal -->
  <div class="modal" id="clickUpgradesModal">
    <div class="modal-content">
      <button class="close-modal" id="closeClickUpgrades">&times;</button>
      <h3 class="modal-title">Click Upgrades</h3>
      <div class="click-upgrades-grid" id="clickUpgradesGrid"></div>
    </div>
  </div>

  <!-- Code Modal -->
  <div class="modal" id="codeModal">
    <div class="modal-content">
      <button class="close-modal" id="closeCodeModal">&times;</button>
      <h3 class="modal-title">Redeem Code</h3>
      <input type="text" class="code-input" id="codeInput" placeholder="Enter code...">
      <button class="submit-btn" id="submitCode">Submit</button>
      <div class="code-message" id="codeMessage"></div>
    </div>
  </div>

  <!-- Username Modal -->
  <div class="modal" id="usernameModal">
    <div class="modal-content">
      <h3 class="modal-title">Choose Your Username</h3>
      <p>Pick a unique display name (3-20 chars, a-z, 0-9, _):</p>
      <input type="text" class="code-input" id="usernameInput" placeholder="Enter username..." maxlength="20">
      <button class="submit-btn" id="saveUsernameBtn">Continue</button>
      <div class="code-message" id="usernameMessage"></div>
    </div>
  </div>

  <!-- Leaderboard Modal -->
  <div class="modal" id="leaderboardModal">
    <div class="modal-content">
      <button class="close-modal" id="closeLeaderboard">&times;</button>
      <h3 class="modal-title">Top Business Tycoons</h3>
      <div class="leaderboard-tabs">
        <button class="tab-btn active" data-tab="combined">Global Leaderboard</button>
      </div>
      <div class="leaderboard-container" id="leaderboardList">
        <div class="loading-spinner"></div>
      </div>
      <div class="leaderboard-countdown" id="leaderboardCountdown"></div>
    </div>
  </div>

  <!-- Admin Panel Modal -->
  <div class="admin-panel" id="adminPanel">
    <div class="admin-content">
      <button class="close-modal" id="closeAdminPanel">&times;</button>
      <h3 class="modal-title">Admin Panel</h3>
      
      <div class="admin-tabs">
        <div class="admin-tab active" data-tab="users">User Management</div>
        <div class="admin-tab" data-tab="messages">Broadcast Message</div>
        <div class="admin-tab" data-tab="settings">Settings</div>
        <button class="admin-tab" id="refreshBtn">Refresh Game</button>
      </div>
      
      <!-- User Management Tab -->
      <div class="admin-tab-content active" id="usersTab">
        <input type="text" class="admin-search" id="userSearch" placeholder="Search users...">
        <div class="admin-user-list" id="userList">
          <div class="loading-spinner"></div>
        </div>
        <div class="admin-status" id="userStatus"></div>
      </div>
      
      <!-- Broadcast Message Tab -->
      <div class="admin-tab-content" id="messagesTab">
        <textarea class="admin-message-input" id="adminMessage" placeholder="Enter message to broadcast to all players..." rows="4"></textarea>
        <button class="submit-btn" id="sendMessageBtn">Send Message</button>
        <div class="admin-status" id="messageStatus"></div>
      </div>
      
      <!-- Settings Tab -->
      <div class="admin-tab-content" id="settingsTab">
        <div class="admin-toggle">
          <label>Leaderboard Auto-Update:</label>
          <label class="toggle-switch">
            <input type="checkbox" id="leaderboardToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <button class="submit-btn" id="saveSettingsBtn">Save Settings</button>
        <div class="admin-status" id="settingsStatus"></div>
      </div>
    </div>
  </div>

  <!-- Tutorial Modal -->
  <div class="tutorial-modal" id="tutorialModal">
    <div class="tutorial-content">
      <h3 class="modal-title">Welcome to Business Empire Clicker!</h3>
      <p>Click the button to earn coins. Use those coins to buy upgrades that generate coins automatically.</p>
      <p>As you progress, you'll unlock more powerful businesses and upgrades.</p>
      <div class="tutorial-buttons">
        <button class="tutorial-btn skip-tutorial" id="skipTutorial">Skip</button>
        <button class="tutorial-btn next-tutorial" id="nextTutorial">Got It!</button>
      </div>
    </div>
  </div>

  <!-- Patch Notes Modal -->
  <div class="patch-modal" id="patchModal">
    <div class="patch-content">
      <button class="patch-close" id="closePatch">&times;</button>
      <h2 class="patch-title">âœ¨ RIP v2.2 âœ¨</h2>
      
      <p style="text-align: center; margin-bottom: 2rem; color: var(--neon-blue);">
        sad!
      </p>
      
      <h3 class="patch-subtitle">NEW FEATURES</h3>
        <li><span class="patch-note">[NEON UI]</span> rip this game battle royal game is ready for beta and release expected monday-friday</li>
        <li><span class="patch-note">[KEYBOARD SHORTCUTS]</span> Space = Click, C = Toggle Chat, P = Patch Notes</li>
      </ul>
      
      <h3 class="patch-subtitle">VISUAL UPGRADES</h3>
      <ul class="patch-features">
        <li>Neon glow effects on all UI elements</li>
        <li>Hacker terminal theme with matrix-style text</li>
        <li>Dark gradient space-like background with animated stars</li>
        <li>Glassmorphism panels with blur effects</li>
        <li>Animated progress bars with pulsing animations</li>
        <li>Holographic buttons with 3D hover effects</li>
      </ul>
      
      <h3 class="patch-subtitle">CHAT SYSTEM</h3>
      <ul class="patch-features">
        <li>Device-to-device messaging using localStorage</li>
        <li>Persists last 100 messages</li>
        <li>Timestamps show relative time</li>
        <li>Username tagging with @mentions</li>
        <li>3-second anti-spam cooldown</li>
        <li>Loads previous chat sessions</li>
      </ul>
      
      <h3 class="patch-subtitle">HOW TO USE</h3>
      <ul class="patch-features">
        <li><span class="patch-note">Chat:</span> Click ðŸ’¬ icon > Type message > Enter</li>
        <li><span class="patch-note">Themes:</span> Right-click settings gear > Select visual style</li>
        <li><span class="patch-note">Shortcuts:</span> Space to click, C for chat, P for patch notes</li>
      </ul>
      
      <p style="margin-top: 2rem; text-align: center; color: var(--neon-green);">
        All original game mechanics remain fully functional with balance adjustments for the new economy system.
      </p>
    </div>
  </div>

  <script>
    // ======================
    // GAME STATE
    // ======================
    const CURRENT_VERSION = "2.1";
    let playerName = "Guest";
    let playerUsername = "";
    let playerEmail = "";
    let playerPicture = "";
    let isSignedIn = false;
    let userId = "";
    let rebirthCount = 0;
    let goldenCoins = 0;
    let currentTab = 'combined';
    let isAdmin = false;
    let leaderboardAutoUpdate = true;
    let usernameChanges = 0;
    const MAX_USERNAME_CHANGES = 5;
    let lastSave = 0;
    let saveInterval;
    let messageCheckInterval;
    let lastBroadcastCheck = 0;
    let hasSeenTutorial = localStorage.getItem('hasSeenTutorial') === 'true';
    let chatCooldown = false;
    let chatVisible = false;
    let lastActiveTime = Date.now();
    let leaderboardData = [];
    let lastLeaderboardUpdate = 0;

    // Game state variables
    let coins = 0;
    let coinsPerClick = 1;
    let coinsPerSecond = 0;
    let spacePressed = false;
    let spaceCooldown = false;
    let highestVisibleUpgrade = 3;
    
    // Chat system variables
    let chatMessages = [];
    const CHAT_KEY = 'businessEmpireGlobalChat';
    const MAX_CHAT_MESSAGES = 100;
    let lastChatUpdate = 0;
    const CHAT_UPDATE_INTERVAL = 3000; // 3 seconds
    
    // Coin images
    const coinImages = [
      "https://github.com/YESSSsj28/TOWER-DEFENSEs/blob/main/pixel-art-game-currency-coin-vector-removebg-preview.png?raw=true",
      "https://github.com/YESSSsj28/TOWER-DEFENSEs/blob/main/pixel-art-illustration-coin-pixelated-coin-coin-pixelated-pixel-art-game-icon-webs_1038602-950__1_-removebg-preview.png?raw=true"
    ];
    
    // Click upgrades data
    const clickUpgrades = [
      { id: 1, name: "+1 Click", amount: 1, cost: 100, purchased: false },
      { id: 2, name: "+5 Clicks", amount: 5, cost: 500, purchased: false },
      { id: 3, name: "+10 Clicks", amount: 10, cost: 1000, purchased: false },
      { id: 4, name: "+100 Clicks", amount: 100, cost: 10000, purchased: false },
      { id: 5, name: "+1K Clicks", amount: 1000, cost: 100000, purchased: false },
      { id: 6, name: "+10K Clicks", amount: 10000, cost: 1000000, purchased: false },
      { id: 7, name: "+100K Clicks", amount: 100000, cost: 10000000, purchased: false },
      { id: 8, name: "+1M Clicks", amount: 1000000, cost: 100000000, purchased: false }
    ];
    
    // Golden coin upgrades (expanded to 19)
    const goldenCoinUpgrades = [
      { id: 1, name: "+10% CPS", cost: 1, purchased: false, effect: 1.1 },
      { id: 2, name: "+25% CPS", cost: 2, purchased: false, effect: 1.25 },
      { id: 3, name: "+50% CPS", cost: 3, purchased: false, effect: 1.5 },
      { id: 4, name: "+100% CPS", cost: 5, purchased: false, effect: 2.0 },
      { id: 5, name: "Double Click Power", cost: 7, purchased: false, effect: 2.0, clickEffect: true },
      { id: 6, name: "+150% CPS", cost: 10, purchased: false, effect: 2.5 },
      { id: 7, name: "Triple Click Power", cost: 15, purchased: false, effect: 3.0, clickEffect: true },
      { id: 8, name: "+200% CPS", cost: 20, purchased: false, effect: 3.0 },
      { id: 9, name: "5x Click Power", cost: 30, purchased: false, effect: 5.0, clickEffect: true },
      { id: 10, name: "+300% CPS", cost: 40, purchased: false, effect: 4.0 },
      { id: 11, name: "10x Click Power", cost: 50, purchased: false, effect: 10.0, clickEffect: true },
      { id: 12, name: "+500% CPS", cost: 60, purchased: false, effect: 6.0 },
      { id: 13, name: "20x Click Power", cost: 75, purchased: false, effect: 20.0, clickEffect: true },
      { id: 14, name: "+750% CPS", cost: 90, purchased: false, effect: 8.5 },
      { id: 15, name: "50x Click Power", cost: 110, purchased: false, effect: 50.0, clickEffect: true },
      { id: 16, name: "+1000% CPS", cost: 130, purchased: false, effect: 11.0 },
      { id: 17, name: "100x Click Power", cost: 150, purchased: false, effect: 100.0, clickEffect: true },
      { id: 18, name: "+1500% CPS", cost: 175, purchased: false, effect: 16.0 },
      { id: 19, name: "200x Click Power", cost: 200, purchased: false, effect: 200.0, clickEffect: true }
    ];

    // Achievements data
    const achievements = [
      { id: 1, name: "First Click", desc: "Click for the first time", reward: 1, unlocked: false, progress: 0, target: 1, stat: 'clicks' },
      { id: 2, name: "Novice Tycoon", desc: "Reach 1,000 coins", reward: 1, unlocked: false, progress: 0, target: 1000, stat: 'coins' },
      { id: 3, name: "Business Mogul", desc: "Reach 1,000,000 coins", reward: 1, unlocked: false, progress: 0, target: 1000000, stat: 'coins' },
      { id: 4, name: "First Upgrade", desc: "Purchase your first business", reward: 1, unlocked: false, progress: 0, target: 1, stat: 'upgradesOwned' },
      { id: 5, name: "Diversified Portfolio", desc: "Own 5 different businesses", reward: 1, unlocked: false, progress: 0, target: 5, stat: 'uniqueUpgrades' },
      { id: 6, name: "Industrialist", desc: "Own 10 of any business", reward: 1, unlocked: false, progress: 0, target: 10, stat: 'maxUpgradeCount' },
      { id: 7, name: "Golden Touch", desc: "Earn your first golden coin", reward: 1, unlocked: false, progress: 0, target: 1, stat: 'goldenCoins' },
      { id: 8, name: "Golden Empire", desc: "Earn 10 golden coins", reward: 1, unlocked: false, progress: 0, target: 10, stat: 'goldenCoins' },
      { id: 9, name: "Click Master", desc: "Reach 100 coins per click", reward: 1, unlocked: false, progress: 0, target: 100, stat: 'coinsPerClick' },
      { id: 10, name: "Idle Profits", desc: "Reach 100 coins per second", reward: 1, unlocked: false, progress: 0, target: 100, stat: 'coinsPerSecond' },
      { id: 11, name: "Rebirth", desc: "Rebirth for the first time", reward: 1, unlocked: false, progress: 0, target: 1, stat: 'rebirthCount' },
      { id: 12, name: "Veteran Investor", desc: "Click 1,000 times", reward: 1, unlocked: false, progress: 0, target: 1000, stat: 'clicks' },
      { id: 13, name: "The Grind", desc: "Click 10,000 times", reward: 1, unlocked: false, progress: 0, target: 10000, stat: 'clicks' },
      { id: 14, name: "AFK Millionaire", desc: "Earn 1,000,000 coins while offline", reward: 1, unlocked: false, progress: 0, target: 1000000, stat: 'afkEarnings' },
      { id: 15, name: "Completionist", desc: "Unlock all achievements", reward: 1, unlocked: false, progress: 0, target: 1, stat: 'achievementsUnlocked' }
    ];

    // Upgrades data (19 upgrades + Death)
    const upgrades = [
      { id: 1, name: "TikTok Shop", baseCost: 10, owned: 0, effect: 0.5, desc: "Basic viral commerce" },
      { id: 2, name: "YouTube Ads", baseCost: 50, owned: 0, effect: 2, desc: "Monetize attention" },
      { id: 3, name: "Instagram Store", baseCost: 100, owned: 0, effect: 3, desc: "Aesthetic capitalism" },
      { id: 4, name: "Dropshipping", baseCost: 200, owned: 0, effect: 5, desc: "Sell what you don't own" },
      { id: 5, name: "Amazon FBA", baseCost: 500, owned: 0, effect: 8, desc: "Warehouse domination" },
      { id: 6, name: "Cryptocurrency", baseCost: 1000, owned: 0, effect: 12, desc: "Digital gold rush" },
      { id: 7, name: "NFT Marketplace", baseCost: 2000, owned: 0, effect: 18, desc: "Tokenize everything" },
      { id: 8, name: "VC Funding", baseCost: 5000, owned: 0, effect: 25, desc: "Other people's money" },
      { id: 9, name: "AI Startup", baseCost: 10000, owned: 0, effect: 35, desc: "Automate the future" },
      { id: 10, name: "Tesla Competitor", baseCost: 20000, owned: 0, effect: 50, desc: "Disrupt transportation" },
      { id: 11, name: "Space Tourism", baseCost: 50000, owned: 0, effect: 75, desc: "The final frontier" },
      { id: 12, name: "Time Travel Tech", baseCost: 100000, owned: 0, effect: 100, desc: "Sell yesterday today" },
      { id: 13, name: "Dyson Sphere", baseCost: 250000, owned: 0, effect: 150, desc: "Harvest a star" },
      { id: 14, name: "Galactic Empire", baseCost: 500000, owned: 0, effect: 225, desc: "Rule the cosmos" },
      { id: 15, name: "Multiverse Corp", baseCost: 1000000, owned: 0, effect: 350, desc: "Infinite markets" },
      { id: 16, name: "Godhood", baseCost: 5000000, owned: 0, effect: 600, desc: "Become divine" },
      { id: 17, name: "Omnipotence", baseCost: 10000000, owned: 0, effect: 1000, desc: "All-powerful" },
      { id: 18, name: "The Singularity", baseCost: 50000000, owned: 0, effect: 2000, desc: "Merge with machines" },
      { id: 19, name: "The Meaning of Life", baseCost: 100000000, owned: 0, effect: 5000, desc: "Ultimate truth" },
      { id: 20, name: "DEATH", baseCost: 1000000000, owned: 0, effect: 0, desc: "Rebirth with golden coins" }
    ];

    // ======================
    // CHAT SYSTEM
    // ======================
    function initChat() {
      loadChatMessages();
      setInterval(loadChatMessages, CHAT_UPDATE_INTERVAL);
    }

    function loadChatMessages() {
      try {
        const savedChat = localStorage.getItem(CHAT_KEY);
        if (savedChat) {
          chatMessages = JSON.parse(savedChat);
          renderChatMessages();
        }
      } catch (e) {
        console.error("Error loading chat messages:", e);
      }
    }

    function saveChatMessages() {
      try {
        localStorage.setItem(CHAT_KEY, JSON.stringify(chatMessages));
      } catch (e) {
        console.error("Error saving chat messages:", e);
      }
    }

    function sendChatMessage() {
      if (chatCooldown) return;
      
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (message && playerUsername) {
        const chatMsg = {
          user: playerUsername,
          text: message,
          timestamp: new Date().toLocaleTimeString(),
          userId: userId || 'guest',
          time: Date.now()
        };
        
        // Add to local chat
        chatMessages.push(chatMsg);
        
        // Keep only the most recent messages
        if (chatMessages.length > MAX_CHAT_MESSAGES) {
          chatMessages = chatMessages.slice(-MAX_CHAT_MESSAGES);
        }
        
        saveChatMessages();
        renderChatMessages();
        input.value = '';
        
        // Set cooldown
        chatCooldown = true;
        setTimeout(() => chatCooldown = false, 3000);
      }
    }

    function renderChatMessages() {
      const container = document.getElementById('chatMessages');
      container.innerHTML = '';
      
      chatMessages.forEach(msg => {
        const msgEl = document.createElement('div');
        msgEl.className = 'chat-message';
        
        // Highlight current user's messages
        if (msg.userId === userId) {
          msgEl.style.background = 'rgba(0, 255, 157, 0.2)';
          msgEl.style.borderLeft = '2px solid var(--neon-green)';
        }
        
        msgEl.innerHTML = `
          <div class="username">${msg.user}</div>
          <div class="timestamp">${msg.timestamp}</div>
          <div class="text">${msg.text}</div>
        `;
        container.appendChild(msgEl);
      });
      
      container.scrollTop = container.scrollHeight;
    }

    function toggleChat() {
      chatVisible = !chatVisible;
      document.getElementById('globalChat').style.display = chatVisible ? 'block' : 'none';
      document.getElementById('chatToggleBtn').textContent = chatVisible ? 'Ã—' : 'ðŸ’¬';
    }

    // ======================
    // GAME FUNCTIONS
    // ======================
    function gameLoop() {
      coins += coinsPerSecond;
      updateDisplay();
      checkForNewUpgrades();
      renderUpgrades();
      renderClickUpgrades();
      renderGoldenUpgrades();
      checkAchievements();
      saveGame(); // Auto-save
    }
    
    function createFallingCoin() {
      const coin = document.createElement('img');
      coin.className = 'falling-coin';
      
      // Choose random coin image (50/50 chance)
      const coinType = Math.random() < 0.5 ? 0 : 1;
      coin.src = coinImages[coinType];
      
      // Random horizontal position
      const xPos = Math.random() * 100;
      coin.style.left = `${xPos}%`;
      
      // Random animation duration (2-4 seconds)
      const duration = 2 + Math.random() * 2;
      coin.style.animationDuration = `${duration}s`;
      
      // Random size (30-50px)
      const size = 30 + Math.random() * 20;
      coin.style.width = `${size}px`;
      coin.style.height = `${size}px`;
      
      // Random rotation speed
      const rotation = Math.random() * 360;
      coin.style.transform = `rotate(${rotation}deg)`;
      
      document.body.appendChild(coin);
      
      // Remove coin after animation completes
      setTimeout(() => {
        coin.remove();
      }, duration * 1000);
    }
    
    function handleClick() {
      coins += coinsPerClick;
      updateDisplay();
      checkForNewUpgrades();
      saveGame();
      
      // Track clicks for achievements
      const clickAchievement = achievements.find(a => a.id === 1);
      if (clickAchievement && !clickAchievement.unlocked) {
        clickAchievement.progress++;
        checkAchievement(clickAchievement);
      }
      
      // Create falling coin
      createFallingCoin();
      
      // Visual feedback
      const coinsDisplay = document.getElementById("coins");
      coinsDisplay.classList.add("pulse");
      setTimeout(() => coinsDisplay.classList.remove("pulse"), 300);
    }
    
    function updateDisplay() {
      document.getElementById("coins").textContent = Math.floor(coins).toLocaleString();
      document.getElementById("cps").textContent = `${coinsPerSecond.toFixed(1)} coins/sec`;
      document.getElementById("goldenCoins").textContent = `Golden Coins: ${goldenCoins}`;
      updateClickerText();
    }
    
    function updateClickerText() {
      document.getElementById("clicker").textContent = `Earn Coins (${coinsPerClick.toLocaleString()} per click)`;
    }
    
    function checkForNewUpgrades() {
      for (let i = 0; i < upgrades.length; i++) {
        const upgrade = upgrades[i];
        const cost = getUpgradeCost(upgrade);
        
        // Show next upgrade when player has 25% of current upgrade's cost
        if (i > highestVisibleUpgrade && coins >= cost * 0.25) {
          highestVisibleUpgrade = i;
          renderUpgrades(); // Immediately show the new upgrade
        }
      }
    }
    
    function renderUpgrades() {
      const upgradesContainer = document.getElementById("upgrades");
      upgradesContainer.innerHTML = "";
      
      const visibleUpgrades = upgrades.slice(0, highestVisibleUpgrade + 1);
      
      visibleUpgrades.forEach(upgrade => {
        const cost = getUpgradeCost(upgrade);
        const canAfford = coins >= cost;
        
        const upgradeEl = document.createElement("div");
        upgradeEl.className = `upgrade ${canAfford ? "unlocked" : "locked"}`;
        upgradeEl.setAttribute('data-id', upgrade.id);
        
        const progress = Math.min(1, coins / cost);
        
        upgradeEl.innerHTML = `
          <div class="upgrade-name">${upgrade.name}</div>
          <div class="upgrade-desc">${upgrade.desc}</div>
          <div>
            <span class="upgrade-cost">${cost.toLocaleString()} coins</span>
            <span class="upgrade-owned">Owned: ${upgrade.owned}</span>
          </div>
          <div class="progress-bar">
            <div class="progress" style="width: ${progress * 100}%"></div>
          </div>
        `;
        
        upgradesContainer.appendChild(upgradeEl);
      });
    }
    
    function renderClickUpgrades() {
      const clickUpgradesGrid = document.getElementById("clickUpgradesGrid");
      clickUpgradesGrid.innerHTML = "";
      
      clickUpgrades.forEach(upgrade => {
        const canAfford = coins >= upgrade.cost && !upgrade.purchased;
        
        const upgradeEl = document.createElement("div");
        upgradeEl.className = `click-upgrade ${canAfford ? "unlocked" : "locked"}`;
        upgradeEl.setAttribute('data-id', upgrade.id);
        
        upgradeEl.innerHTML = `
          <div class="click-upgrade-name">${upgrade.name}</div>
          <div class="click-upgrade-desc">+${upgrade.amount.toLocaleString()} coins per click</div>
          <div class="click-upgrade-cost">${upgrade.cost.toLocaleString()} coins</div>
          ${upgrade.purchased ? '<div class="click-upgrade-owned">Purchased</div>' : ''}
        `;
        
        clickUpgradesGrid.appendChild(upgradeEl);
      });
    }
    
    function renderGoldenUpgrades() {
      const goldenUpgradesContainer = document.getElementById("goldenUpgrades");
      goldenUpgradesContainer.innerHTML = "";
      
      goldenCoinUpgrades.forEach(upgrade => {
        const canAfford = goldenCoins >= upgrade.cost && !upgrade.purchased;
        
        const upgradeEl = document.createElement("div");
        upgradeEl.className = `upgrade ${canAfford ? "unlocked" : "locked"}`;
        upgradeEl.setAttribute('data-id', upgrade.id);
        
        upgradeEl.innerHTML = `
          <div class="upgrade-name">${upgrade.name}</div>
          <div class="upgrade-desc">${upgrade.clickEffect ? `Multiplies click power by ${upgrade.effect}` : `Multiplies CPS by ${upgrade.effect}`}</div>
          <div>
            <span class="upgrade-cost" style="color: var(--gold)">${upgrade.cost} golden coins</span>
            <span class="upgrade-owned">${upgrade.purchased ? 'Purchased' : ''}</span>
          </div>
        `;
        
        goldenUpgradesContainer.appendChild(upgradeEl);
      });
    }
    
    function renderAchievements() {
      const achievementsContainer = document.getElementById("achievements");
      achievementsContainer.innerHTML = "";
      
      achievements.forEach(achievement => {
        const achievementEl = document.createElement("div");
        achievementEl.className = `achievement ${achievement.unlocked ? "unlocked" : "locked"}`;
        
        const progress = achievement.unlocked ? 100 : (achievement.progress / achievement.target * 100);
        
        achievementEl.innerHTML = `
          <div class="achievement-name">${achievement.name}</div>
          <div class="achievement-desc">${achievement.desc}</div>
          <div class="achievement-reward">Reward: ${achievement.reward} golden coins</div>
          ${!achievement.unlocked ? `
            <div class="achievement-progress">
              <div class="achievement-progress-bar" style="width: ${progress}%"></div>
            </div>
          ` : ''}
        `;
        
        achievementsContainer.appendChild(achievementEl);
      });
    }
    
    function buyUpgrade(id) {
      const upgrade = upgrades.find(u => u.id === id);
      const cost = getUpgradeCost(upgrade);
      
      if (coins >= cost) {
        coins -= cost;
        upgrade.owned++;
        
        // Special handling for DEATH upgrade
        if (upgrade.name === "DEATH") {
          triggerRebirth();
          return;
        }
        
        coinsPerSecond += upgrade.effect;
        updateDisplay();
        renderUpgrades();
        saveGame();
        
        // Check achievements
        checkAchievements();
        
        // Visual feedback
        const upgradeEl = document.querySelector(`.upgrade[data-id="${id}"]`);
        if (upgradeEl) {
          upgradeEl.classList.add('purchase-effect');
          setTimeout(() => upgradeEl.classList.remove('purchase-effect'), 300);
        }
      }
    }
    
    function buyClickUpgrade(id) {
      const upgrade = clickUpgrades.find(u => u.id === id);
      
      if (!upgrade.purchased && coins >= upgrade.cost) {
        coins -= upgrade.cost;
        coinsPerClick += upgrade.amount;
        upgrade.purchased = true;
        updateDisplay();
        renderClickUpgrades();
        saveGame();
        
        // Visual feedback
        const upgradeEl = document.querySelector(`.click-upgrade[data-id="${id}"]`);
        if (upgradeEl) {
          upgradeEl.classList.add('purchase-effect');
          setTimeout(() => upgradeEl.classList.remove('purchase-effect'), 300);
        }
      }
    }
    
    function buyGoldenUpgrade(id) {
      const upgrade = goldenCoinUpgrades.find(u => u.id === id);
      
      if (!upgrade.purchased && goldenCoins >= upgrade.cost) {
        goldenCoins -= upgrade.cost;
        upgrade.purchased = true;
        
        // Apply upgrade effect
        if (upgrade.clickEffect) {
          coinsPerClick *= upgrade.effect;
        } else {
          coinsPerSecond *= upgrade.effect;
        }
        
        updateDisplay();
        renderGoldenUpgrades();
        saveGame();
        
        // Visual feedback
        const upgradeEl = document.querySelector(`#goldenUpgrades .upgrade[data-id="${id}"]`);
        if (upgradeEl) {
          upgradeEl.classList.add('purchase-effect');
          setTimeout(() => upgradeEl.classList.remove('purchase-effect'), 300);
        }
      }
    }
    
  function triggerRebirth() {
        // Calculate golden coins earned (1 for first rebirth, up to 7 max per rebirth)
        const coinsEarned = Math.min(rebirthCount + 1, 7);
        goldenCoins += coinsEarned; // Add earned coins to existing golden coins

        // Increment rebirth count
        rebirthCount++;

        // --- Reset the main game state ---
        coins = 0;              // Reset regular coins to zero
        coinsPerClick = 1;      // Reset base click power to 1
        coinsPerSecond = 0;     // Reset base passive income to zero
        highestVisibleUpgrade = 3; // Reset upgrade visibility

        // Reset owned counts for all regular business upgrades
        upgrades.forEach(upgrade => {
            // Don't reset the DEATH upgrade itself, though it doesn't matter much
            if (upgrade.name !== "DEATH") {
                upgrade.owned = 0;
            } else {
                // Optionally reset the DEATH upgrade's owned count if desired
                // upgrade.owned = 0;
            }
        });

        // Reset purchased status for regular click upgrades
        clickUpgrades.forEach(upgrade => {
            upgrade.purchased = false;
        });

        // --- Golden Coin Upgrades are NOT reset ---
        // They are persistent rewards.
        // Now, re-apply effects of purchased *golden* upgrades to the *reset base* values.
        goldenCoinUpgrades.forEach(upgrade => {
            if (upgrade.purchased) { // Only apply effects of already purchased golden upgrades
                if (upgrade.clickEffect) {
                    // Apply click multiplier to the *new base* click value (which is 1 initially)
                    coinsPerClick *= upgrade.effect;
                }
                // Passive golden upgrades (CPS multipliers) don't need direct application here.
                // Their effect is multiplicative on the CPS generated by *regular* businesses.
                // Since regular businesses are reset to 0 owned, the base CPS is 0.
                // As the player re-buys businesses, these multipliers will naturally take effect.
            }
        });
        // --- End of Reset Logic ---


        // Update UI with reset values and new golden coin total
        updateDisplay();
        renderUpgrades(); // Show the reset state of business upgrades
        renderClickUpgrades(); // Show the reset state of click upgrades
        renderGoldenUpgrades(); // Show which golden upgrades are still purchased

        // Show rebirth animation/feedback
        for (let i = 0; i < 20; i++) {
            setTimeout(() => createFallingCoin(), i * 100);
        }

        // Notify the player
        alert(`Rebirth complete! Earned ${coinsEarned} golden coins! Rebirth Count: ${rebirthCount}`); // Updated alert

        // Check achievements (e.g., the rebirth achievement)
        checkAchievements();

        // Save the game state immediately after rebirth changes
        saveGame();
    }
    
    function redeemCode() {
      const codeInput = document.getElementById("codeInput");
      const codeMessage = document.getElementById("codeMessage");
      
      const code = codeInput.value.trim();
      
      if (code === "yugpatel2009") {
        coins = Infinity;
        coinsPerClick = Infinity;
        coinsPerSecond = Infinity;
        updateDisplay();
        codeMessage.textContent = "Success! Infinite coins granted!";
        codeMessage.style.color = "var(--neon-green)";
        saveGame();
        
        // Close modal after 2 seconds
        setTimeout(() => {
          document.getElementById("codeModal").style.display = "none";
          codeMessage.textContent = "";
          codeInput.value = "";
        }, 2000);
      } else {
        codeMessage.textContent = "Invalid code!";
        codeMessage.style.color = "var(--neon-pink)";
      }
    }
    
    function getUpgradeCost(upgrade) {
      return Math.floor(upgrade.baseCost * Math.pow(1.5, upgrade.owned));
    }

    // ======================
    // ACHIEVEMENTS SYSTEM
    // ======================
    function checkAchievements() {
      // Get current stats
      const stats = {
        coins: coins,
        coinsPerClick: coinsPerClick,
        coinsPerSecond: coinsPerSecond,
        goldenCoins: goldenCoins,
        rebirthCount: rebirthCount,
        upgradesOwned: upgrades.reduce((sum, u) => sum + u.owned, 0),
        uniqueUpgrades: upgrades.filter(u => u.owned > 0).length,
        maxUpgradeCount: Math.max(...upgrades.map(u => u.owned)),
        clicks: achievements.find(a => a.id === 1).progress,
        afkEarnings: achievements.find(a => a.id === 14).progress,
        achievementsUnlocked: achievements.filter(a => a.unlocked).length
      };
      
      // Check each achievement
      achievements.forEach(achievement => {
        if (!achievement.unlocked) {
          // Update progress based on stat
          if (achievement.stat === 'clicks' || achievement.stat === 'afkEarnings') {
            // These are handled separately
          } else {
            achievement.progress = stats[achievement.stat];
          }
          
          // Check if achievement is completed
          if (achievement.progress >= achievement.target) {
            unlockAchievement(achievement);
          }
        }
      });
      
      renderAchievements();
    }
    
    function checkAchievement(achievement) {
      if (!achievement.unlocked && achievement.progress >= achievement.target) {
        unlockAchievement(achievement);
      }
    }
    
    function unlockAchievement(achievement) {
      achievement.unlocked = true;
      goldenCoins += achievement.reward;
      
      // Show notification
      const notification = document.createElement('div');
      notification.className = 'broadcast-message';
      notification.textContent = `Achievement Unlocked: ${achievement.name}! +${achievement.reward} golden coins!`;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
      
      updateDisplay();
      renderAchievements();
      saveGame();
    }

    // ======================
    // AFK EARNINGS SYSTEM
    // ======================
    function checkAFKEarnings() {
      const lastActive = localStorage.getItem('lastActiveTime');
      if (!lastActive) return;
      
      const now = Date.now();
      const timeAway = now - parseInt(lastActive);
      
      // Only calculate if away for more than 1 minute
      if (timeAway > 60000) {
        const awaySeconds = Math.floor(timeAway / 1000);
        const earnedCoins = Math.floor(awaySeconds * coinsPerSecond);
        
        if (earnedCoins > 0) {
          coins += earnedCoins;
          
          // Update AFK earnings achievement
          const afkAchievement = achievements.find(a => a.id === 14);
          if (afkAchievement) {
            afkAchievement.progress += earnedCoins;
            checkAchievement(afkAchievement);
          }
          
          // Show AFK earnings
          document.getElementById('afkEarnings').style.display = 'block';
          document.getElementById('afkAmount').textContent = earnedCoins.toLocaleString();
          
          // Hide after 5 seconds
          setTimeout(() => {
            document.getElementById('afkEarnings').style.display = 'none';
          }, 5000);
          
          updateDisplay();
          saveGame();
        }
      }
    }

    // ======================
    // AUTHENTICATION SYSTEM
    // ======================
    function handleGoogleSignIn(response) {
      try {
        const userData = parseJWT(response.credential);
        playerName = userData.name;
        playerEmail = userData.email;
        playerPicture = userData.picture;
        userId = userData.sub;
        isSignedIn = true;
        
        // First check if user is banned
        checkBanStatus().then(isBanned => {
          if (isBanned) {
            showBannedMessage();
            return;
          }
          
          // Check if admin
          if (playerEmail === "yhpatel@lcstudents.com") {
            isAdmin = true;
            document.getElementById('adminBtn').style.display = "block";
          }
          
          // Hide Google sign-in button
          document.querySelector('.g_id_signin').style.display = 'none';
          document.getElementById('signOutBtn').style.display = "block";
          
          // Check if user already has a username
          const savedUser = localStorage.getItem(`user_${userId}`);
          if (savedUser) {
            const user = JSON.parse(savedUser);
            usernameChanges = user.usernameChanges || 0;
            
            // Check if username is still unique
            if (checkUsernameUniqueness(user.username)) {
              playerUsername = user.username;
              updateUserDisplay();
              loadGame();
            } else {
              // Username was taken by someone else, reset it
              localStorage.removeItem(`user_${userId}`);
              showUsernameModal();
            }
          } else {
            showUsernameModal();
          }
          
          // Save basic user info
          localStorage.setItem('googleUser', JSON.stringify({
            name: playerName,
            email: playerEmail,
            picture: playerPicture,
            id: userId
          }));
          
          // Start frequent saving and message checking
          startAutoSave();
          startMessageChecking();
          
          // Show tutorial if first time
          if (!hasSeenTutorial) {
            showTutorial();
          }
          
          // Initialize chat
          initChat();
          
          // Check for AFK earnings
          checkAFKEarnings();
          
          // Give 3 golden coins to new players
          const saveKey = `businessEmpireSave_${userId}`;
          if (!localStorage.getItem(saveKey)) {
            goldenCoins += 3;
            updateDisplay();
            saveGame();
          }
        });
      } catch (error) {
        console.error("Error handling Google sign-in:", error);
        alert("There was an error signing in. Please try again.");
      }
    }

    function showTutorial() {
      document.getElementById("tutorialModal").style.display = "flex";
    }

    function closeTutorial() {
      document.getElementById("tutorialModal").style.display = "none";
      localStorage.setItem('hasSeenTutorial', 'true');
      hasSeenTutorial = true;
    }

    async function checkBanStatus() {
      try {
        // First check local storage
        if (localStorage.getItem(`banned_${userId}`)) {
          return true;
        }
        
        return false;
      } catch (error) {
        console.error("Error checking ban status:", error);
        return false;
      }
    }

    function showBannedMessage() {
      // Create banned message overlay
      const bannedEl = document.createElement('div');
      bannedEl.className = 'banned-message';
      bannedEl.innerHTML = `
        <h2>You have been banned!</h2>
        <p>Banned haha -yug.</p>
        <button id="signOutAfterBan">Sign Out</button>
      `;
      document.body.appendChild(bannedEl);
      
      // Add sign out button listener
      document.getElementById('signOutAfterBan').addEventListener('click', signOut);
      
      // Hide all game elements
      document.querySelector('.container').style.display = 'none';
      document.querySelector('.top-buttons').style.display = 'none';
    }

    function checkUsernameUniqueness(username) {
      if (!username) return false;
      const allUsers = JSON.parse(localStorage.getItem('allUsernames') || '{}');
      return !allUsers[username.toLowerCase()] || allUsers[username.toLowerCase()] === userId;
    }

    function showUsernameModal() {
      document.getElementById("usernameModal").style.display = "flex";
      document.getElementById("usernameInput").value = playerName;
      document.getElementById("usernameInput").focus();
    }

    function saveUsername() {
      const usernameInput = document.getElementById("usernameInput");
      const usernameMessage = document.getElementById("usernameMessage");
      
      if (usernameChanges >= MAX_USERNAME_CHANGES) {
        usernameMessage.textContent = `You can only change username ${MAX_USERNAME_CHANGES} times`;
        usernameMessage.style.color = "var(--neon-pink)";
        return;
      }

      const newUsername = usernameInput.value.trim();
      
      // Validate username
      if (newUsername.length < 3) {
        usernameMessage.textContent = "Username must be at least 3 characters";
        usernameMessage.style.color = "var(--neon-pink)";
        return;
      }
      
      if (newUsername.length > 20) {
        usernameMessage.textContent = "Username must be 20 characters or less";
        usernameMessage.style.color = "var(--neon-pink)";
        return;
      }
      
      if (!/^[a-zA-Z0-9_]+$/.test(newUsername)) {
        usernameMessage.textContent = "Only letters, numbers and underscores allowed";
        usernameMessage.style.color = "var(--neon-pink)";
        return;
      }
      
      // Check uniqueness
      if (!checkUsernameUniqueness(newUsername)) {
        usernameMessage.textContent = "Username already taken";
        usernameMessage.style.color = "var(--neon-pink)";
        return;
      }
      
      // Update username tracking
      const allUsers = JSON.parse(localStorage.getItem('allUsernames') || '{}');
      
      // Remove old username if exists
      if (playerUsername) {
        delete allUsers[playerUsername.toLowerCase()];
      }
      
      // Add new username
      playerUsername = newUsername;
      allUsers[newUsername.toLowerCase()] = userId;
      localStorage.setItem('allUsernames', JSON.stringify(allUsers));
      
      // Save user profile
      localStorage.setItem(`user_${userId}`, JSON.stringify({
        username: playerUsername,
        picture: playerPicture,
        usernameChanges: usernameChanges + 1
      }));
      
      usernameChanges++;
      
      // Close modal and update UI
      document.getElementById("usernameModal").style.display = "none";
      updateUserDisplay();
      saveGame(); // Immediate save
    }

    function updateUserDisplay() {
      const userProfile = document.getElementById("userProfile");
      const userAvatar = document.getElementById("userAvatar");
      const userName = document.getElementById("userName");
      
      userProfile.style.display = "flex";
      userAvatar.src = playerPicture;
      userName.textContent = playerUsername;
    }

    function signOut() {
      try {
        // Clear intervals
        clearInterval(saveInterval);
        clearInterval(messageCheckInterval);
        
        google.accounts.id.disableAutoSelect();
        google.accounts.id.revoke(localStorage.getItem('googleUserEmail'), () => {
          console.log('Consent revoked');
        });
        
        isSignedIn = false;
        isAdmin = false;
        playerName = "Guest";
        playerUsername = "";
        userId = "";
        
        document.querySelector('.g_id_signin').style.display = 'block';
        document.getElementById('userProfile').style.display = 'none';
        document.getElementById('signOutBtn').style.display = "none";
        document.getElementById('adminBtn').style.display = "none";
        
        localStorage.removeItem('googleUser');
        
        // Remove banned message if exists
        const bannedEl = document.querySelector('.banned-message');
        if (bannedEl) {
          bannedEl.remove();
        }
        
        // Show game elements again
        document.querySelector('.container').style.display = 'block';
        document.querySelector('.top-buttons').style.display = 'flex';
        
        // Load guest game state
        loadGame();
      } catch (error) {
        console.error("Error signing out:", error);
      }
    }

    function parseJWT(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      return JSON.parse(atob(base64));
    }

    // ======================
    // SAVE SYSTEM
    // ======================
    function startAutoSave() {
      // Clear any existing interval
      if (saveInterval) clearInterval(saveInterval);
      
      // Save every 2 seconds when signed in, every 10 seconds for guests
      const saveFrequency = isSignedIn ? 2000 : 10000;
      saveInterval = setInterval(() => {
        if (Date.now() - lastSave > saveFrequency) {
          saveGame();
          lastSave = Date.now();
        }
      }, saveFrequency);
    }

    function startMessageChecking() {
      // Clear any existing interval
      if (messageCheckInterval) clearInterval(messageCheckInterval);
      
      // Check for messages every 30 seconds
      messageCheckInterval = setInterval(() => {
        checkForBroadcastMessages();
      }, 30000);
      
      // Initial check
      checkForBroadcastMessages();
    }

    function saveGame() {
      try {
        // Save last active time
        localStorage.setItem('lastActiveTime', Date.now().toString());
        
        const gameData = {
          coins,
          coinsPerClick,
          coinsPerSecond,
          highestVisibleUpgrade,
          goldenCoins,
          rebirthCount,
          upgrades: upgrades.map(u => ({ id: u.id, owned: u.owned })),
          clickUpgrades: clickUpgrades.map(cu => ({ id: cu.id, purchased: cu.purchased })),
          goldenCoinUpgrades: goldenCoinUpgrades.map(gcu => ({ id: gcu.id, purchased: gcu.purchased })),
          achievements: achievements.map(a => ({
            id: a.id,
            unlocked: a.unlocked,
            progress: a.progress
          })),
          username: playerUsername,
          avatar: playerPicture || "",
          id: userId,
          lastUpdated: Date.now()
        };

        // Save locally with user ID prefix (or 'guest' for guest mode)
        const saveKey = `businessEmpireSave_${userId || 'guest'}`;
        localStorage.setItem(saveKey, JSON.stringify(gameData));
      } catch (error) {
        console.error("Error saving game:", error);
      }
    }

    function loadGame() {
      try {
        // Check if we have a saved game for this user (or guest)
        const saveKey = `businessEmpireSave_${userId || 'guest'}`;
        const localSave = localStorage.getItem(saveKey);
        if (localSave) {
          const savedData = JSON.parse(localSave);
          loadGameData(savedData);
        } else {
          // No saved game - start fresh
          resetGameState();
        }
        
        // Load admin settings
        const autoUpdate = localStorage.getItem('leaderboardAutoUpdate');
        if (autoUpdate !== null) {
          leaderboardAutoUpdate = autoUpdate === 'true';
          document.getElementById('leaderboardToggle').checked = leaderboardAutoUpdate;
        }
        
        // Render achievements
        renderAchievements();
      } catch (error) {
        console.error("Error loading game:", error);
        resetGameState();
      }
    }
    
    function resetGameState() {
      coins = 0;
      coinsPerClick = 1;
      coinsPerSecond = 0;
      goldenCoins = 0;
      highestVisibleUpgrade = 3;
      rebirthCount = 0;
      
      // Reset all upgrades
      upgrades.forEach(upgrade => {
        upgrade.owned = 0;
      });
      
      // Reset click upgrades
      clickUpgrades.forEach(upgrade => {
        upgrade.purchased = false;
      });
      
      // Reset golden coin upgrades
      goldenCoinUpgrades.forEach(upgrade => {
        upgrade.purchased = false;
      });
      
      // Reset achievements
      achievements.forEach(achievement => {
        achievement.unlocked = false;
        achievement.progress = 0;
      });
      
      updateDisplay();
      renderUpgrades();
      renderClickUpgrades();
      renderGoldenUpgrades();
      renderAchievements();
    }
    
    function loadGameData(gameData) {
      if (!gameData) return;
      
      coins = gameData.coins || 0;
      coinsPerClick = gameData.coinsPerClick || 1;
      coinsPerSecond = gameData.coinsPerSecond || 0;
      goldenCoins = gameData.goldenCoins || 0;
      highestVisibleUpgrade = gameData.highestVisibleUpgrade || 3;
      rebirthCount = gameData.rebirthCount || 0;
      
      // Merge upgrades
      if (gameData.upgrades) {
        gameData.upgrades.forEach(savedUpgrade => {
          const existingUpgrade = upgrades.find(u => u.id === savedUpgrade.id);
          if (existingUpgrade) {
            existingUpgrade.owned = savedUpgrade.owned || 0;
          }
        });
      }
      
      if (gameData.clickUpgrades) {
        gameData.clickUpgrades.forEach(savedClickUpgrade => {
          const existingClickUpgrade = clickUpgrades.find(cu => cu.id === savedClickUpgrade.id);
          if (existingClickUpgrade) {
            existingClickUpgrade.purchased = savedClickUpgrade.purchased || false;
          }
        });
      }
      
      if (gameData.goldenCoinUpgrades) {
        gameData.goldenCoinUpgrades.forEach(savedGoldenUpgrade => {
          const existingGoldenUpgrade = goldenCoinUpgrades.find(gcu => gcu.id === savedGoldenUpgrade.id);
          if (existingGoldenUpgrade) {
            existingGoldenUpgrade.purchased = savedGoldenUpgrade.purchased || false;
            
            // Apply upgrade effects
            if (existingGoldenUpgrade.purchased) {
              if (existingGoldenUpgrade.clickEffect) {
                coinsPerClick *= existingGoldenUpgrade.effect;
              } else {
                coinsPerSecond *= existingGoldenUpgrade.effect;
              }
            }
          }
        });
      }
      
      // Load achievements
      if (gameData.achievements) {
        gameData.achievements.forEach(savedAchievement => {
          const existingAchievement = achievements.find(a => a.id === savedAchievement.id);
          if (existingAchievement) {
            existingAchievement.unlocked = savedAchievement.unlocked || false;
            existingAchievement.progress = savedAchievement.progress || 0;
          }
        });
      }
      
      updateDisplay();
      renderUpgrades();
      renderClickUpgrades();
      renderGoldenUpgrades();
      renderAchievements();
    }

    // ======================
    // LEADERBOARD SYSTEM
    // ======================
    async function updateLeaderboard() {
      const now = Date.now();
      
      // Only fetch from API if data is stale (older than 10 minutes) and auto-update is on
      if (now - lastLeaderboardUpdate > 600000 && leaderboardAutoUpdate) {
        const leaderboardList = document.getElementById("leaderboardList");
        leaderboardList.innerHTML = '<div class="loading-spinner"></div>';
        
        try {
          // In a real implementation, this would fetch from an API
          // For now we'll just use localStorage
          loadFromCache();
          lastLeaderboardUpdate = now;
        } catch (error) {
          console.error("Error loading leaderboard:", error);
          // Load from cache if API fails
          loadFromCache();
        }
      }
      
      updateLeaderboardDisplay();
      startCountdown();
    }

    function cleanDuplicateUsernames() {
      const usernameMap = {};
      const cleanedData = [];
      
      leaderboardData.forEach(user => {
        if (user.username) {
          const lowerUsername = user.username.toLowerCase();
          if (usernameMap[lowerUsername]) {
            // Duplicate found - reset this user's username
            if (usernameMap[lowerUsername] !== user.id) {
              user.username = "";
              
              // Remove from local storage if exists
              const userKey = `user_${user.id}`;
              const userData = JSON.parse(localStorage.getItem(userKey) || '{}');
              if (userData.username) {
                delete userData.username;
                localStorage.setItem(userKey, JSON.stringify(userData));
              }
            }
          } else {
            usernameMap[lowerUsername] = user.id;
          }
        }
        cleanedData.push(user);
      });
      
      leaderboardData = cleanedData;
    }

    function loadFromCache() {
      const cached = localStorage.getItem('leaderboardCache');
      if (cached) {
        const parsed = JSON.parse(cached);
        leaderboardData = parsed.data || [];
      } else {
        leaderboardData = [];
      }
    }

    function updateLeaderboardDisplay() {
      const leaderboardList = document.getElementById("leaderboardList");
      
      if (leaderboardData.length === 0) {
        leaderboardList.innerHTML = '<p>No leaderboard data available</p>';
        return;
      }

      // Sort based on rebirths first, then coins
      const sortedData = [...leaderboardData].sort((a, b) => {
        // First sort by rebirths (descending)
        if ((b.rebirthCount || 0) !== (a.rebirthCount || 0)) {
          return (b.rebirthCount || 0) - (a.rebirthCount || 0);
        }
        // If rebirths are equal, sort by coins (descending)
        return (b.coins || 0) - (a.coins || 0);
      });

      renderLeaderboard(sortedData);
    }

    function renderLeaderboard(data) {
      const leaderboardList = document.getElementById("leaderboardList");
      leaderboardList.innerHTML = '';

      // Filter out banned users and those with no coins or rebirths
      const filteredData = data.filter(user => {
        const isBanned = localStorage.getItem(`banned_${user.id}`) === 'true';
        return !isBanned && ((user.coins > 0 || user.rebirthCount > 0));
      });

      // Sort again after filtering (same logic as above)
      const sortedData = [...filteredData].sort((a, b) => {
        if ((b.rebirthCount || 0) !== (a.rebirthCount || 0)) {
          return (b.rebirthCount || 0) - (a.rebirthCount || 0);
        }
        return (b.coins || 0) - (a.coins || 0);
      });

      // Show top 20
      sortedData.slice(0, 20).forEach((entry, index) => {
        const entryEl = document.createElement('div');
        entryEl.className = 'leaderboard-entry';
        
        entryEl.innerHTML = `
          <div class="leaderboard-rank">${index + 1}</div>
          <div class="leaderboard-user">
            ${entry.avatar ? `<img src="${entry.avatar}" class="leaderboard-avatar" alt="${entry.username}">` : ''}
            <span>${entry.username || "Anonymous"}</span>
          </div>
          <div class="leaderboard-rebirths">${entry.rebirthCount || 0}</div>
          <div class="leaderboard-score">${Math.floor(entry.coins || 0).toLocaleString()}</div>
        `;

        // Highlight current user
        if (entry.id === userId) {
          entryEl.style.background = 'rgba(124, 58, 237, 0.15)';
          entryEl.style.borderLeft = '4px solid var(--primary)';
        }

        leaderboardList.appendChild(entryEl);
      });

      // Add current user if not in top 20
      if (userId && !sortedData.slice(0, 20).some(e => e.id === userId)) {
        const userEntry = leaderboardData.find(e => e.id === userId);
        if (userEntry) {
          const userPosition = sortedData.findIndex(e => e.id === userId);
          if (userPosition !== -1) {
            const entryEl = document.createElement('div');
            entryEl.className = 'leaderboard-entry';
            entryEl.style.background = 'rgba(124, 58, 237, 0.15)';
            entryEl.style.borderLeft = '4px solid var(--primary)';
            
            entryEl.innerHTML = `
              <div class="leaderboard-rank">${userPosition + 1}</div>
              <div class="leaderboard-user">
                ${userEntry.avatar ? `<img src="${userEntry.avatar}" class="leaderboard-avatar">` : ''}
                <span>${userEntry.username || "You"}</span>
              </div>
              <div class="leaderboard-rebirths">${userEntry.rebirthCount || 0}</div>
              <div class="leaderboard-score">${Math.floor(userEntry.coins || 0).toLocaleString()}</div>
            `;
            
            leaderboardList.appendChild(entryEl);
          }
        }
      }
      
      // Add headers
      const headerEl = document.createElement('div');
      headerEl.className = 'leaderboard-entry';
      headerEl.style.fontWeight = 'bold';
      headerEl.style.borderBottom = '2px solid var(--accent)';
      headerEl.style.background = 'var(--bg-darker)';
      headerEl.innerHTML = `
        <div class="leaderboard-rank">#</div>
        <div class="leaderboard-user">Player</div>
        <div class="leaderboard-rebirths">Rebirths</div>
        <div class="leaderboard-score">Coins</div>
      `;
      leaderboardList.insertBefore(headerEl, leaderboardList.firstChild);
    }
    
    function startCountdown() {
      const now = Date.now();
      const nextUpdate = lastLeaderboardUpdate + 600000;
      const timeLeft = Math.max(0, nextUpdate - now);
      const leaderboardCountdown = document.getElementById("leaderboardCountdown");
      
      updateCountdownDisplay(timeLeft);
      
      // Update countdown every second
      const countdownInterval = setInterval(() => {
        const now = Date.now();
        const timeLeft = Math.max(0, nextUpdate - now);
        
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          leaderboardCountdown.textContent = "Updating leaderboard...";
          // Refresh the leaderboard
          lastLeaderboardUpdate = 0;
          updateLeaderboard();
        } else {
          updateCountdownDisplay(timeLeft);
        }
      }, 1000);
    }
    
    function updateCountdownDisplay(ms) {
      const minutes = Math.floor(ms / (60 * 1000));
      const seconds = Math.floor((ms % (60 * 1000)) / 1000);
      document.getElementById("leaderboardCountdown").textContent = `Next update in: ${minutes}m ${seconds}s`;
    }

    // ======================
    // ADMIN PANEL FUNCTIONS
    // ======================
    async function loadUserList() {
      const userList = document.getElementById("userList");
      const userStatus = document.getElementById("userStatus");
      
      userList.innerHTML = '<div class="loading-spinner"></div>';
      userStatus.textContent = '';
      
      try {
        // Try to load from cache
        loadFromCache();
        lastLeaderboardUpdate = Date.now();
      } catch (error) {
        console.error("Error loading leaderboard:", error);
        leaderboardData = [];
      }
      
      renderUserList();
    }
    
    function renderUserList() {
      const userList = document.getElementById("userList");
      userList.innerHTML = '';
      
      if (leaderboardData.length === 0) {
        userList.innerHTML = '<p>No user data available</p>';
        return;
      }
      
      // Sort users by rebirths then coins
      const sortedUsers = [...leaderboardData].sort((a, b) => {
        if ((b.rebirthCount || 0) !== (a.rebirthCount || 0)) {
          return (b.rebirthCount || 0) - (a.rebirthCount || 0);
        }
        return (b.coins || 0) - (a.coins || 0);
      });
      
      sortedUsers.forEach(user => {
        const isBanned = localStorage.getItem(`banned_${user.id}`) === 'true';
        
        const userEl = document.createElement('div');
        userEl.className = 'admin-user';
        
        userEl.innerHTML = `
          <div class="admin-user-info">
            <img src="${user.avatar || 'https://via.placeholder.com/32'}" class="admin-user-avatar" alt="${user.username}">
            <span class="admin-username">${user.username || "Anonymous"}</span>
          </div>
          <div class="admin-user-actions">
            <button class="admin-action-btn edit-btn" data-id="${user.id}">Edit</button>
            ${isBanned ? 
              `<button class="admin-action-btn unban-btn" data-id="${user.id}">Unban</button>` : 
              `<button class="admin-action-btn ban-btn" data-id="${user.id}">Ban</button>`
            }
          </div>
        `;
        
        userList.appendChild(userEl);
      });
      
      // Add event listeners to buttons
      document.querySelectorAll('.ban-btn').forEach(btn => {
        btn.addEventListener('click', () => banUser(btn.dataset.id));
      });
      
      document.querySelectorAll('.unban-btn').forEach(btn => {
        btn.addEventListener('click', () => unbanUser(btn.dataset.id));
      });
      
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => editUser(btn.dataset.id));
      });
    }
    
    async function banUser(userId) {
      try {
        // Ban locally
        localStorage.setItem(`banned_${userId}`, 'true');
        
        const userStatus = document.getElementById("userStatus");
        userStatus.textContent = 'User banned successfully';
        userStatus.className = 'admin-status success';
        
        // Update both admin panel and leaderboard immediately
        renderUserList();
        if (document.getElementById("leaderboardModal").style.display === 'flex') {
          updateLeaderboardDisplay();
        }
        
        // If banning current user, show banned message
        if (userId === this.userId) {
          showBannedMessage();
        }
      } catch (error) {
        console.error("Error banning user:", error);
        const userStatus = document.getElementById("userStatus");
        userStatus.textContent = 'Error banning user';
        userStatus.className = 'admin-status error';
      }
    }
    
    async function unbanUser(userId) {
      try {
        // Unban locally
        localStorage.removeItem(`banned_${userId}`);
        
        const userStatus = document.getElementById("userStatus");
        userStatus.textContent = 'User unbanned successfully';
        userStatus.className = 'admin-status success';
        
        // Update both admin panel and leaderboard immediately
        renderUserList();
        if (document.getElementById("leaderboardModal").style.display === 'flex') {
          updateLeaderboardDisplay();
        }
      } catch (error) {
        console.error("Error unbanning user:", error);
        const userStatus = document.getElementById("userStatus");
        userStatus.textContent = 'Error unbanning user';
        userStatus.className = 'admin-status error';
      }
    }
    
    function editUser(userId) {
      try {
        const user = leaderboardData.find(u => u.id === userId);
        if (!user) return;
        
        const newCoins = prompt(`Enter new coins for ${user.username || 'user'}:`, user.coins || 0);
        if (newCoins === null) return;
        
        const coinsValue = newCoins.toLowerCase() === 'infinity' ? Infinity : parseFloat(newCoins);
        if (isNaN(coinsValue)) {
          const userStatus = document.getElementById("userStatus");
          userStatus.textContent = 'Invalid coin amount';
          userStatus.className = 'admin-status error';
          return;
        }
        
        const newRebirths = prompt(`Enter new rebirth count for ${user.username || 'user'}:`, user.rebirthCount || 0);
        if (newRebirths === null) return;
        
        const rebirthsValue = parseInt(newRebirths);
        if (isNaN(rebirthsValue)) {
          const userStatus = document.getElementById("userStatus");
          userStatus.textContent = 'Invalid rebirth count';
          userStatus.className = 'admin-status error';
          return;
        }
        
        user.coins = coinsValue;
        user.rebirthCount = rebirthsValue;
        
        // Update local data
        const cached = localStorage.getItem('leaderboardCache');
        if (cached) {
          const parsed = JSON.parse(cached);
          const userIndex = parsed.data.findIndex(u => u.id === userId);
          if (userIndex !== -1) {
            parsed.data[userIndex].coins = coinsValue;
            parsed.data[userIndex].rebirthCount = rebirthsValue;
            localStorage.setItem('leaderboardCache', JSON.stringify(parsed));
          }
        }
        
        // Update displayed data
        const userIndex = leaderboardData.findIndex(u => u.id === userId);
        if (userIndex !== -1) {
          leaderboardData[userIndex].coins = coinsValue;
          leaderboardData[userIndex].rebirthCount = rebirthsValue;
        }
        
        // Update cloud data if this is the current user
        if (userId === this.userId) {
          coins = coinsValue;
          rebirthCount = rebirthsValue;
          updateDisplay();
          saveGame();
        }
        
        const userStatus = document.getElementById("userStatus");
        userStatus.textContent = `Updated ${user.username || 'user'}'s stats`;
        userStatus.className = 'admin-status success';
        
        // Update leaderboard display if open
        if (document.getElementById("leaderboardModal").style.display === 'flex') {
          updateLeaderboardDisplay();
        }
        
        // Update user list
        renderUserList();
      } catch (error) {
        console.error("Error editing user:", error);
      }
    }
    
    async function sendBroadcastMessage() {
      const adminMessage = document.getElementById("adminMessage");
      const messageStatus = document.getElementById("messageStatus");
      
      const message = adminMessage.value.trim();
      if (!message) {
        messageStatus.textContent = 'Please enter a message';
        messageStatus.className = 'admin-status error';
        return;
      }
      
      try {
        const sendBtn = document.getElementById("sendMessageBtn");
        sendBtn.classList.add('btn-loading');
        sendBtn.disabled = true;
        
        // Save message to localStorage
        localStorage.setItem('lastBroadcastMessage', JSON.stringify({
          text: message,
          timestamp: Date.now()
        }));
        
        messageStatus.textContent = 'Message sent to all players';
        messageStatus.className = 'admin-status success';
        adminMessage.value = '';
        
        // Show the message immediately
        showBroadcastMessage(message);
      } catch (error) {
        console.error("Error sending message:", error);
        messageStatus.textContent = 'Error sending message';
        messageStatus.className = 'admin-status error';
      } finally {
        const sendBtn = document.getElementById("sendMessageBtn");
        sendBtn.classList.remove('btn-loading');
        sendBtn.disabled = false;
      }
    }
    
    async function checkForBroadcastMessages() {
      try {
        // Only check every 30 seconds
        const now = Date.now();
        if (now - lastBroadcastCheck < 30000) return;
        lastBroadcastCheck = now;
        
        // Get broadcast message from localStorage
        const broadcast = JSON.parse(localStorage.getItem('lastBroadcastMessage') || 'null');
        
        if (broadcast && broadcast.text) {
          // Check if this is a new message (not the same as last shown)
          const lastShownMessage = localStorage.getItem('lastShownMessage');
          if (!lastShownMessage || lastShownMessage !== broadcast.text) {
            showBroadcastMessage(broadcast.text);
            localStorage.setItem('lastShownMessage', broadcast.text);
          }
        }
      } catch (error) {
        console.error("Error checking for broadcast messages:", error);
      }
    }
    
    function showBroadcastMessage(message) {
      // Remove any existing broadcast message
      const existingMessage = document.getElementById('broadcastMessage');
      if (existingMessage) {
        existingMessage.remove();
      }
      
      // Create new broadcast message display
      const broadcastEl = document.createElement('div');
      broadcastEl.id = 'broadcastMessage';
      broadcastEl.className = 'broadcast-message';
      broadcastEl.textContent = message;
      document.body.appendChild(broadcastEl);
      
      // Auto-hide after 3 seconds
      setTimeout(() => {
        broadcastEl.remove();
      }, 3000);
    }
    
    function saveAdminSettings() {
      try {
        leaderboardAutoUpdate = document.getElementById("leaderboardToggle").checked;
        localStorage.setItem('leaderboardAutoUpdate', leaderboardAutoUpdate.toString());
        
        const settingsStatus = document.getElementById("settingsStatus");
        settingsStatus.textContent = 'Settings saved successfully';
        settingsStatus.className = 'admin-status success';
        
        setTimeout(() => {
          settingsStatus.textContent = '';
          settingsStatus.className = 'admin-status';
        }, 2000);
      } catch (error) {
        console.error("Error saving settings:", error);
      }
    }

    // ======================
    // PATCH NOTES SYSTEM
    // ======================
    function showPatchNotes() {
      const lastSeenVersion = localStorage.getItem('lastSeenVersion');
      
      // Only show if never seen before or if version changed
      if (!lastSeenVersion || lastSeenVersion !== CURRENT_VERSION) {
        document.getElementById("patchModal").style.display = "flex";
        document.body.style.overflow = "hidden";
        createConfetti();
        localStorage.setItem('lastSeenVersion', CURRENT_VERSION);
      }
    }
    
    function createConfetti() {
      const colors = ['var(--neon-pink)', 'var(--neon-blue)', 'var(--neon-purple)', 'var(--neon-green)', 'var(--matrix-green)'];
      
      for (let i = 0; i < 150; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = Math.random() * 10 + 5 + 'px';
        
        // Random X movement direction (-1 to 1)
        const randomX = (Math.random() * 2) - 1;
        confetti.style.setProperty('--random-x', randomX);
        
        // Random animation duration (3-8 seconds)
        const duration = 3 + Math.random() * 5;
        confetti.style.animation = `confetti-fall ${duration}s linear forwards`;
        confetti.style.animationDelay = Math.random() * 2 + 's';
        
        document.body.appendChild(confetti);
        
        // Remove confetti after animation
        setTimeout(() => confetti.remove(), duration * 1000);
      }
    }

    // ======================
    // EVENT LISTENERS
    // ======================
    document.addEventListener('DOMContentLoaded', () => {
      try {
        // Check for forced refresh
        if (localStorage.getItem('forceRefresh') === 'true') {
          localStorage.removeItem('forceRefresh');
          showBroadcastMessage("Game refreshed by admin");
        }
        
        // Load saved user if exists
        const savedUser = localStorage.getItem('googleUser');
        if (savedUser) {
          const user = JSON.parse(savedUser);
          playerName = user.name;
          playerEmail = user.email;
          playerPicture = user.picture;
          userId = user.id;
          isSignedIn = true;
          
          // First check if user is banned
          checkBanStatus().then(isBanned => {
            if (isBanned) {
              showBannedMessage();
              return;
            }
            
            // Check if admin
            if (playerEmail === "yhpatel@lcstudents.com") {
              isAdmin = true;
              document.getElementById('adminBtn').style.display = "block";
            }
            
            // Update UI
            document.querySelector('.g_id_signin').style.display = 'none';
            document.getElementById('signOutBtn').style.display = "block";
            
            // Load username if exists
            const userData = localStorage.getItem(`user_${userId}`);
            if (userData) {
              const user = JSON.parse(userData);
              playerUsername = user.username || playerName;
              usernameChanges = user.usernameChanges || 0;
              updateUserDisplay();
            }
            
            // Start auto-save and message checking
            startAutoSave();
            startMessageChecking();
            
            // Show tutorial if first time
            if (!hasSeenTutorial) {
              showTutorial();
            }
            
            // Initialize chat
            initChat();
            
            // Check for AFK earnings
            checkAFKEarnings();
            
            // Give 3 golden coins to new players
            const saveKey = `businessEmpireSave_${userId}`;
            if (!localStorage.getItem(saveKey)) {
              goldenCoins += 3;
              updateDisplay();
              saveGame();
            }
          });
        }
        
        // Initialize game
        highestVisibleUpgrade = 3; // Show first few upgrades by default
        renderUpgrades();
        renderClickUpgrades();
        renderGoldenUpgrades();
        renderAchievements();
        setInterval(gameLoop, 1000);
        updateClickerText();
        loadGame();
        
        // Check for broadcast messages
        checkForBroadcastMessages();
        
        // Set up auto-refresh
        setupAutoRefresh();
        
        // Add all button event listeners
        setupEventListeners();
        
        // Show patch notes if needed
        setTimeout(showPatchNotes, 1500);
      } catch (error) {
        console.error("Error initializing game:", error);
      }
    });

    function setupEventListeners() {
      // Button listeners
      document.getElementById('upgradeClicksBtn').addEventListener('click', () => {
        document.getElementById("clickUpgradesModal").style.display = "flex";
      });
      
      document.getElementById('codeBtn').addEventListener('click', () => {
        document.getElementById("codeModal").style.display = "flex";
      });
      
      document.getElementById('leaderboardBtn').addEventListener('click', () => {
        document.getElementById("leaderboardModal").style.display = "flex";
        updateLeaderboard();
      });
      
      document.getElementById('signOutBtn').addEventListener('click', signOut);
      
      document.getElementById('adminBtn').addEventListener('click', () => {
        document.getElementById("adminPanel").style.display = "flex";
        loadUserList();
      });
      
      // Tutorial buttons
      document.getElementById('skipTutorial').addEventListener('click', closeTutorial);
      document.getElementById('nextTutorial').addEventListener('click', closeTutorial);
      
      // Patch notes close button
      document.getElementById('closePatch').addEventListener('click', function() {
        document.getElementById("patchModal").style.animation = 'fadeIn 0.4s cubic-bezier(0.22, 1, 0.36, 1) reverse';
        setTimeout(() => {
          document.getElementById("patchModal").style.display = "none";
          document.body.style.overflow = "auto";
        }, 350);
      });
      
      // Close patch notes when clicking outside
      document.getElementById('patchModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('patchModal')) {
          document.getElementById("patchModal").style.animation = 'fadeIn 0.4s cubic-bezier(0.22, 1, 0.36, 1) reverse';
          setTimeout(() => {
            document.getElementById("patchModal").style.display = "none";
            document.body.style.overflow = "auto";
          }, 350);
        }
      });
      
      // Admin panel tab switching
      document.querySelectorAll('.admin-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove("active"));
          tab.classList.add("active");
          
          document.querySelectorAll('.admin-tab-content').forEach(content => {
            content.classList.remove("active");
          });
          document.getElementById(`${tab.dataset.tab}Tab`).classList.add("active");
        });
      });
      
      // Admin panel user search
      document.getElementById('userSearch').addEventListener('input', () => {
        const searchTerm = document.getElementById('userSearch').value.toLowerCase();
        const users = document.getElementById('userList').querySelectorAll(".admin-user");
        
        users.forEach(user => {
          const username = user.querySelector(".admin-username").textContent.toLowerCase();
          if (username.includes(searchTerm)) {
            user.style.display = "flex";
          } else {
            user.style.display = "none";
          }
        });
      });
      
      // Close modal listeners
      document.getElementById('closeClickUpgrades').addEventListener('click', () => {
        document.getElementById("clickUpgradesModal").style.display = "none";
      });
      
      document.getElementById('closeCodeModal').addEventListener('click', () => {
        document.getElementById("codeModal").style.display = "none";
      });
      
      document.getElementById('closeLeaderboard').addEventListener('click', () => {
        document.getElementById("leaderboardModal").style.display = "none";
      });
      
      document.getElementById('closeAdminPanel').addEventListener('click', () => {
        document.getElementById("adminPanel").style.display = "none";
      });
      
      // Code redemption
      document.getElementById('submitCode').addEventListener('click', redeemCode);
      document.getElementById('codeInput').addEventListener('keypress', (e) => {
        if (e.key === "Enter") {
          redeemCode();
        }
      });
      
      // Clicker button
      const clickerButton = document.getElementById('clicker');
      clickerButton.addEventListener('click', handleClick);
      clickerButton.addEventListener('touchstart', handleClick, {passive: true});
      
      // Username edit button
      document.getElementById('usernameContainer').addEventListener('click', () => {
        document.getElementById("usernameModal").style.display = "flex";
      });
      
      // Spacebar handling with cooldown
      document.addEventListener('keydown', (e) => {
        if (e.code === "Space" && !spacePressed && !spaceCooldown) {
          e.preventDefault();
          spacePressed = true;
          handleClick();
          
          // Visual feedback
          document.getElementById("clicker").classList.add("pulse");
          setTimeout(() => document.getElementById("clicker").classList.remove("pulse"), 300);
          
          // Cooldown
          spaceCooldown = true;
          setTimeout(() => spaceCooldown = false, 300);
        }
        
        // Keyboard shortcuts
        if (e.key.toLowerCase() === 'c') {
          e.preventDefault();
          toggleChat();
        }
        
        if (e.key.toLowerCase() === 'p') {
          e.preventDefault();
          document.getElementById("patchModal").style.display = "flex";
          document.body.style.overflow = "hidden";
        }
      });
      
      document.addEventListener('keyup', (e) => {
        if (e.code === "Space") {
          spacePressed = false;
        }
      });
      
      // Close any modal when clicking outside content
      document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.style.display = 'none';
          }
        });
      });
      
      // Upgrade click handlers
      document.addEventListener('click', function(e) {
        // Handle business upgrades
        if (e.target.closest('.upgrade.unlocked')) {
          const upgradeId = parseInt(e.target.closest('.upgrade').getAttribute('data-id'));
          buyUpgrade(upgradeId);
        }
        
        // Handle click upgrades
        if (e.target.closest('.click-upgrade.unlocked')) {
          const upgradeId = parseInt(e.target.closest('.click-upgrade').getAttribute('data-id'));
          buyClickUpgrade(upgradeId);
        }
        
        // Handle golden coin upgrades
        if (e.target.closest('#goldenUpgrades .upgrade.unlocked')) {
          const upgradeId = parseInt(e.target.closest('.upgrade').getAttribute('data-id'));
          buyGoldenUpgrade(upgradeId);
        }
      });
      
      // Admin panel actions
      document.getElementById('sendMessageBtn').addEventListener('click', sendBroadcastMessage);
      document.getElementById('saveSettingsBtn').addEventListener('click', saveAdminSettings);
      
      // Chat system listeners
      document.getElementById('chatInput').addEventListener('keypress', (e) => {
        if (e.key === "Enter") {
          sendChatMessage();
        }
      });
      
      document.getElementById('sendChatBtn').addEventListener('click', sendChatMessage);
      document.getElementById('chatToggleBtn').addEventListener('click', toggleChat);
      document.getElementById('closeChatBtn').addEventListener('click', toggleChat);
      
      // Username modal
      document.getElementById('saveUsernameBtn').addEventListener('click', saveUsername);
      document.getElementById('usernameInput').addEventListener('keypress', (e) => {
        if (e.key === "Enter") {
          saveUsername();
        }
      });
    }

    function setupAutoRefresh() {
      // Auto-refresh every 10 minutes (600,000 ms)
      setTimeout(() => {
        location.reload();
      }, 600000);
      
      // Manual refresh button in admin panel
      document.getElementById('refreshBtn').addEventListener('click', () => {
        // Force immediate refresh for everyone
        localStorage.setItem('forceRefresh', 'true');
        location.reload();
      });
    }
  </script>
</body>
</html>











<style>
  /* Modern Dark Patch Notes Modal with Transparent BG */
  .patch-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.4s cubic-bezier(0.22, 1, 0.36, 1);
  }
  
  .patch-content {
    background: rgba(22, 25, 28, 0.95);
    border-radius: 18px;
    width: 90%;
    max-width: 500px;
    padding: 2.5rem;
    position: relative;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
    color: #fff;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    backdrop-filter: blur(16px);
  }
  
  .patch-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
  }
  
  .close-patch {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    color: rgba(255, 255, 255, 0.8);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    font-size: 1.3rem;
    border: none;
    backdrop-filter: blur(4px);
  }
  
  .close-patch:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
    color: white;
  }
  
  .patch-title {
    font-size: 1.9rem;
    margin-bottom: 1.5rem;
    color: white;
    font-weight: 700;
    letter-spacing: -0.5px;
    line-height: 1.3;
  }
  
  .patch-text {
    line-height: 1.7;
    margin-bottom: 1.5rem;
    color: rgba(255, 255, 255, 0.85);
    font-size: 1.1rem;
    font-weight: 400;
  }
  
  .patch-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 0.4rem 1.2rem;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 1.8rem;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
  }
  
  .patch-features {
    margin: 1.8rem 0;
  }
  
  .patch-feature {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1rem;
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.05rem;
  }
  
  .patch-feature::before {
    content: 'â–¹';
    color: var(--accent);
    font-size: 1.1rem;
    margin-right: 0.8rem;
    line-height: 1;
  }
  
  .feedback-link {
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 1px solid rgba(0, 206, 201, 0.3);
    transition: all 0.25s ease;
    padding-bottom: 2px;
    display: inline-block;
  }
  
  .feedback-link:hover {
    color: white;
    border-bottom-color: var(--accent);
  }
  
  .warning-text {
    color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
    padding: 0.8rem;
    border-radius: 6px;
    margin: 1.2rem 0;
    border-left: 3px solid #ff6b6b;
    font-weight: 500;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

<!-- Add to your HTML (before </body>) -->
<div class="patch-modal" id="patchModal">
  <div class="patch-content">
    <button class="close-patch" id="closePatch">&times;</button>
    <div class="patch-badge">NEW UPDATE</div>
    <h3 class="patch-title">Latest Improvements</h3>
    
    <p class="patch-text">
      We've made several important updates to enhance your gaming experience:
    </p>
    
    <div class="patch-features">
      <div class="patch-feature">
        <span>Fixed leaderboard functionality</span>
      </div>
      <div class="patch-feature">
        <span>Automatically give 3 golden coins to everyone</span>
      </div>
      <div class="patch-feature">
        <span>Fixed chat system</span>
      </div>
      <div class="patch-feature">
        <span>Made buttons easier to click</span>
      </div>
      <div class="patch-feature">
        <span>Added achievements system</span>
      </div>
      <div class="patch-feature">
        <span>Added AFK earnings for golden coins</span>
      </div>
      <div class="patch-feature">
        <span>Expanded golden coin upgrades to 19 total</span>
      </div>
      <div class="patch-feature">
        <span>Fixed game saving system</span>
      </div>
    </div>
    
    <p class="patch-text">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLScPOqrRMIviZR163cYp2wIqkGQigwTR8jU-Qb7Hrl3tMUinGA/viewform?usp=dialog" 
         class="feedback-link" 
         target="_blank"
         rel="noopener noreferrer">
        Click here to submit feedback â†’
      </a>
    </p>
  </div>
</div>

<!-- Add to your JavaScript -->
<script>
  // Enhanced Patch Notes Modal
  const patchModal = document.getElementById("patchModal");
  const closePatch = document.getElementById("closePatch");
  
  // Show modal with delay
  window.addEventListener('load', () => {
    setTimeout(() => {
      patchModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }, 1200);
  });
  
  // Close handlers
  closePatch.addEventListener('click', () => {
    patchModal.style.animation = 'fadeIn 0.4s cubic-bezier(0.22, 1, 0.36, 1) reverse';
    setTimeout(() => {
      patchModal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }, 350);
  });
  
  // Close when clicking outside
  patchModal.addEventListener('click', (e) => {
    if (e.target === patchModal) {
      patchModal.style.animation = 'fadeIn 0.4s cubic-bezier(0.22, 1, 0.36, 1) reverse';
      setTimeout(() => {
        patchModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }, 350);
    }
  });
</script>
